<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>å¤§å±ä½œä¸šæ˜¾ç¤º - è¯¾å ‚çª—</title>
    <!-- ä¼˜åŒ–èµ„æºåŠ è½½ï¼šä½¿ç”¨deferå’Œpreloadæå‡æ€§èƒ½ -->
    <link rel="preload" href="../assets/css/big-screen-floating.css" as="style">
    <link rel="preload" href="../assets/css/hide-scrollbar.css" as="style">
    <link rel="stylesheet" href="../assets/css/big-screen-floating.css">
    <link rel="stylesheet" href="../assets/css/hide-scrollbar.css">
    <!-- å»¶è¿ŸåŠ è½½Fluent UIç»„ä»¶ï¼Œæå‡é¦–å±åŠ è½½é€Ÿåº¦ -->
    <script type="module" src="https://unpkg.com/@fluentui/web-components" defer></script>
</head>

<body>
    <!-- æ ‡é¢˜æ  -->
    <div class="title-bar">
        <div class="title">ä½œä¸šå¤§å±</div>
        <div class="title-bar-buttons">
        </div>
    </div>

    <div class="content-container" id="contentContainer">
        <div class="homework-grid" id="homeworkGrid">
            <!-- ä½œä¸šå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
        </div>
    </div>
    
    <!-- æ— æ¡†çª—å£è°ƒæ•´å¤§å°æ‰‹æŸ„ -->
    <div class="resize-handle top"></div>
    <div class="resize-handle bottom"></div>
    <div class="resize-handle left"></div>
    <div class="resize-handle right"></div>
    <div class="resize-handle top-left"></div>
    <div class="resize-handle top-right"></div>
    <div class="resize-handle bottom-left"></div>
    <div class="resize-handle bottom-right"></div>

    <!-- æ‚¬æµ®çƒ -->
    <div class="floating-ball" id="floatingBall">
        <div class="floating-ball-icon">âš™ï¸</div>
    </div>

    <!-- å¯åŠ¨å° -->
    <div class="launchpad" id="launchpad">
        <div class="launchpad-content">
            <div class="launchpad-item" id="launchpadHomework">
                <div class="launchpad-item-icon">ğŸ“š</div>
                <div class="launchpad-item-text">ä½œä¸š</div>
            </div>
            <div class="launchpad-item" id="launchpadSettings">
                <div class="launchpad-item-icon">âš™ï¸</div>
                <div class="launchpad-item-text">è®¾ç½®</div>
            </div>
            <div class="launchpad-item" id="launchpadClose">
                <div class="launchpad-item-icon">âœ•</div>
                <div class="launchpad-item-text">å…³é—­</div>
            </div>
        </div>
    </div>

    <script>
        // å¯¼å…¥ IPC é€šä¿¡
        const { ipcRenderer } = require('electron');
        
        // å…¨å±€å˜é‡
        let currentFontSize = 14;
        let currentColumns = '2';
        let currentOpacity = 95;
        let currentCardOpacity = 80;
        let isCardOpacityFollow = true;
        let isDragging = false;
        let isResizing = false;
        let resizeEdge = '';
        let startX, startY;
        let currentStyle = 'classwindow-plus';
        let isFloatingBallExpanded = false;
        let isBigScreenVisible = true;
        
        // èŠ‚æµå‡½æ•°ï¼Œé™åˆ¶å‡½æ•°è°ƒç”¨é¢‘ç‡
        function throttle(func, limit) {
            let inThrottle;
            return function() {
                const args = arguments;
                const context = this;
                if (!inThrottle) {
                    func.apply(context, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            }
        }
        
        // ä¼˜åŒ–çš„çª—å£ç§»åŠ¨å‡½æ•°
        const optimizedMoveWindow = throttle((deltaX, deltaY) => {
            ipcRenderer.send('move-big-screen-window-by-delta', deltaX, deltaY);
        }, 16); // çº¦60fps
        
        // ä¼˜åŒ–çš„çª—å£è°ƒæ•´å¤§å°å‡½æ•°
        const optimizedResizeWindow = throttle((edge, deltaX, deltaY) => {
            ipcRenderer.send('resize-big-screen-window', {
                edge: edge,
                deltaX: deltaX,
                deltaY: deltaY
            });
        }, 16); // çº¦60fps
        
        // åˆå§‹åŒ–å‡½æ•°
        function init() {
            // ç«‹å³è®¾ç½®ä¸ºå¿½ç•¥é¼ æ ‡æ“ä½œï¼Œç¡®ä¿å¯åŠ¨æ—¶å°±ç½®äºåº•å±‚
            ipcRenderer.send('set-ignore-mouse-events', { 
                ignore: true,
                forward: true
            });
            
            // ä»é…ç½®ä¸­åˆå§‹åŒ–è®¾ç½®
            ipcRenderer.send('get-big-screen-settings');
            
            // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
            setupEventListeners();
            
            // åŠ è½½ä½œä¸šæ•°æ®
            loadHomeworkData();
            
            // ä¿®å¤xè½´ç§»åŠ¨é—®é¢˜
            document.body.style.overflowX = 'hidden';
            document.documentElement.style.overflowX = 'hidden';
        }
        
        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // æ‚¬æµ®çƒäº‹ä»¶
            setupFloatingBall();
            
            // å¯åŠ¨å°äº‹ä»¶
            setupLaunchpad();
            
            // è°ƒæ•´å¤§å°æ‰‹æŸ„æ”¯æŒ
            setupResizeHandles();
            
            // å¿½è§†é¼ æ ‡æ“ä½œæ”¯æŒ
            setupUnderlaySupport();
            
            // IPCäº‹ä»¶ç›‘å¬å™¨
            setupIpcListeners();
        }
        
        // è®¾ç½®æ‚¬æµ®çƒ
        function setupFloatingBall() {
            const floatingBall = document.getElementById('floatingBall');
            if (!floatingBall) return;
            
            // é¼ æ ‡äº‹ä»¶
            floatingBall.addEventListener('click', (e) => {
                toggleFloatingBall();
                e.preventDefault();
                e.stopPropagation();
            });
            
            // é¼ æ ‡æ‚¬åœæ•ˆæœ
            floatingBall.addEventListener('mouseenter', () => {
                floatingBall.classList.add('hover');
                // å¼€å¯é¼ æ ‡ç›‘å¬
                ipcRenderer.send('set-ignore-mouse-events', { ignore: false });
            });
            
            floatingBall.addEventListener('mouseleave', () => {
                floatingBall.classList.remove('hover');
                // å…³é—­é¼ æ ‡ç›‘å¬
                ipcRenderer.send('set-ignore-mouse-events', { 
                    ignore: true,
                    forward: true
                });
            });
        }
        
        // è®¾ç½®å¯åŠ¨å°
        function setupLaunchpad() {
            const launchpad = document.getElementById('launchpad');
            const launchpadHomework = document.getElementById('launchpadHomework');
            const launchpadSettings = document.getElementById('launchpadSettings');
            const launchpadClose = document.getElementById('launchpadClose');
            
            if (!launchpad) return;
            
            // ä½œä¸šæŒ‰é’®
            if (launchpadHomework) {
                launchpadHomework.addEventListener('click', (e) => {
                    toggleBigScreen();
                    e.preventDefault();
                    e.stopPropagation();
                });
            }
            
            // è®¾ç½®æŒ‰é’®
            if (launchpadSettings) {
                launchpadSettings.addEventListener('click', (e) => {
                    ipcRenderer.send('open-settings');
                    e.preventDefault();
                    e.stopPropagation();
                });
            }
            
            // å…³é—­æŒ‰é’®
            if (launchpadClose) {
                launchpadClose.addEventListener('click', (e) => {
                    ipcRenderer.send('close-big-screen-homework');
                    e.preventDefault();
                    e.stopPropagation();
                });
            }
        }
        
        // åˆ‡æ¢æ‚¬æµ®çƒå±•å¼€/æ”¶èµ·
        function toggleFloatingBall() {
            isFloatingBallExpanded = !isFloatingBallExpanded;
            const launchpad = document.getElementById('launchpad');
            
            if (isFloatingBallExpanded) {
                launchpad.classList.add('expanded');
            } else {
                launchpad.classList.remove('expanded');
            }
        }
        
        // åˆ‡æ¢å¤§å±æ¨¡å¼æ˜¾ç¤º/éšè—
        function toggleBigScreen() {
            isBigScreenVisible = !isBigScreenVisible;
            const contentContainer = document.getElementById('contentContainer');
            const floatingBall = document.getElementById('floatingBall');
            const launchpad = document.getElementById('launchpad');
            
            // å…ˆæ”¶èµ·å¯åŠ¨å°
            launchpad.classList.remove('expanded');
            isFloatingBallExpanded = false;
            
            if (isBigScreenVisible) {
                // å±•å¼€å¤§å±æ¨¡å¼
                contentContainer.style.display = 'flex';
                setTimeout(() => {
                    contentContainer.classList.remove('hidden');
                    contentContainer.classList.add('expanded');
                }, 10);
                floatingBall.classList.add('active');
            } else {
                // æ”¶èµ·å¤§å±æ¨¡å¼åˆ°æ‚¬æµ®çƒ
                contentContainer.classList.add('hidden');
                contentContainer.classList.remove('expanded');
                floatingBall.classList.remove('active');
                setTimeout(() => {
                    contentContainer.style.display = 'none';
                }, 400);
            }
        }
        
        // åˆ‡æ¢æ‚¬æµ®çƒçŠ¶æ€
        function toggleFloatingBall() {
            const launchpad = document.getElementById('launchpad');
            
            if (!isFloatingBallExpanded) {
                // å±•å¼€å¯åŠ¨å°
                launchpad.classList.add('expanded');
                isFloatingBallExpanded = true;
            } else {
                // æ”¶èµ·å¯åŠ¨å°
                launchpad.classList.remove('expanded');
                isFloatingBallExpanded = false;
            }
        }
        
        // è®¾ç½®è°ƒæ•´å¤§å°æ‰‹æŸ„
        function setupResizeHandles() {
            const resizeHandles = document.querySelectorAll('.resize-handle');
            
            // ä¸ºæ¯ä¸ªè°ƒæ•´å¤§å°æ‰‹æŸ„æ·»åŠ æ ·å¼å’Œäº‹ä»¶ç›‘å¬
            resizeHandles.forEach(handle => {
                // æ·»åŠ è§†è§‰åé¦ˆæ ·å¼
                handle.style.transition = 'background-color 0.2s ease';
                handle.style.zIndex = '1000'; // ç¡®ä¿æ‰‹æŸ„åœ¨æœ€ä¸Šå±‚
                handle.style.pointerEvents = 'auto'; // ç¡®ä¿å¯ä»¥æ¥æ”¶é¼ æ ‡äº‹ä»¶
                
                // æ ¹æ®æ‰‹æŸ„ä½ç½®è®¾ç½®å…‰æ ‡æ ·å¼
                const edge = handle.classList[1];
                const cursorStyles = {
                    'top': 'ns-resize',
                    'bottom': 'ns-resize',
                    'left': 'ew-resize',
                    'right': 'ew-resize',
                    'top-left': 'nesw-resize',
                    'top-right': 'nwse-resize',
                    'bottom-left': 'nwse-resize',
                    'bottom-right': 'nesw-resize'
                };
                
                if (cursorStyles[edge]) {
                    handle.style.cursor = cursorStyles[edge];
                }
                
                // é¼ æ ‡æ‚¬åœäº‹ä»¶ - ç¡®ä¿å¼€å¯é¼ æ ‡ç›‘å¬
                handle.addEventListener('mouseenter', () => {
                    // å¼€å¯é¼ æ ‡ç›‘å¬
                    ipcRenderer.send('set-ignore-mouse-events', { ignore: false });
                    // è§†è§‰åé¦ˆ - æ‚¬åœçŠ¶æ€
                    handle.style.backgroundColor = 'rgba(0, 120, 212, 0.2)';
                });
                
                // é¼ æ ‡ç¦»å¼€äº‹ä»¶ - æ¢å¤å¿½è§†é¼ æ ‡æ“ä½œ
                handle.addEventListener('mouseleave', () => {
                    if (!isResizing) {
                        // å…³é—­é¼ æ ‡ç›‘å¬
                        ipcRenderer.send('set-ignore-mouse-events', { 
                            ignore: true,
                            forward: true
                        });
                        // ç§»é™¤è§†è§‰åé¦ˆ
                        handle.style.backgroundColor = '';
                    }
                });
                
                // é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶
                handle.addEventListener('mousedown', (e) => {
                    isResizing = true;
                    resizeEdge = handle.classList[1];
                    
                    // è®°å½•å¼€å§‹ä½ç½®
                    startX = e.clientX;
                    startY = e.clientY;
                    
                    // è§†è§‰åé¦ˆ - æŒ‰ä¸‹çŠ¶æ€
                    handle.style.backgroundColor = 'rgba(0, 120, 212, 0.3)';
                    
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // å¼€å¯é¼ æ ‡ç›‘å¬
                    ipcRenderer.send('set-ignore-mouse-events', { ignore: false });
                    
                    // é€šçŸ¥ä¸»è¿›ç¨‹å¼€å§‹è°ƒæ•´å¤§å°
                    ipcRenderer.send('start-resizing', resizeEdge);
                });
            });
            
            // é¼ æ ‡é‡Šæ”¾äº‹ä»¶
            document.addEventListener('mouseup', () => {
                if (isResizing) {
                    isResizing = false;
                    resizeEdge = '';
                    ipcRenderer.send('stop-resizing');
                    
                    // ç§»é™¤æ‰€æœ‰æ‰‹æŸ„çš„è§†è§‰åé¦ˆ
                    resizeHandles.forEach(handle => {
                        handle.style.backgroundColor = '';
                    });
                    
                    // å»¶è¿Ÿå…³é—­é¼ æ ‡ç›‘å¬ï¼Œç¡®ä¿æ“ä½œå®Œæˆ
                    setTimeout(() => {
                        ipcRenderer.send('set-ignore-mouse-events', { 
                            ignore: true,
                            forward: true
                        });
                    }, 100);
                }
            });
            
            // é¼ æ ‡ç§»åŠ¨äº‹ä»¶ - å¤„ç†è°ƒæ•´å¤§å°
            document.addEventListener('mousemove', (e) => {
                if (isResizing) {
                    // è®¡ç®—é¼ æ ‡ç§»åŠ¨çš„è·ç¦»
                    const deltaX = e.clientX - startX;
                    const deltaY = e.clientY - startY;
                    
                    // ä½¿ç”¨ä¼˜åŒ–çš„çª—å£è°ƒæ•´å¤§å°å‡½æ•°ï¼Œé™åˆ¶IPCæ¶ˆæ¯å‘é€é¢‘ç‡
                    optimizedResizeWindow(resizeEdge, deltaX, deltaY);
                    
                    // æ›´æ–°èµ·å§‹ä½ç½®
                    startX = e.clientX;
                    startY = e.clientY;
                    
                    // ç¡®ä¿é¼ æ ‡äº‹ä»¶è¢«æ­£ç¡®å¤„ç†
                    e.preventDefault();
                    e.stopPropagation();
                }
            });
        }
        
        // è®¾ç½®å¿½è§†é¼ æ ‡æ“ä½œæ”¯æŒ
        function setupUnderlaySupport() {
            const contentContainer = document.querySelector('.content-container');
            if (!contentContainer) return;
            
            // å®šä¹‰äº¤äº’å…ƒç´ é€‰æ‹©å™¨
            const interactiveSelectors = 'button, fluent-button, .floating-ball, .resize-handle, .launchpad-item';
            
            // åªåœ¨äº¤äº’å…ƒç´ ä¸Šå¼€å¯é¼ æ ‡ç›‘å¬
            const updateInteractiveElements = () => {
                const interactiveElements = contentContainer.querySelectorAll(interactiveSelectors);
                const floatingBall = document.getElementById('floatingBall');
                const launchpad = document.getElementById('launchpad');
                
                // å¤„ç†æ‚¬æµ®çƒ
                if (floatingBall) {
                    floatingBall.removeEventListener('mouseenter', handleMouseEnter);
                    floatingBall.removeEventListener('mouseleave', handleMouseLeave);
                    floatingBall.addEventListener('mouseenter', handleMouseEnter);
                    floatingBall.addEventListener('mouseleave', handleMouseLeave);
                }
                
                // å¤„ç†å¯åŠ¨å°
                if (launchpad) {
                    const launchpadItems = launchpad.querySelectorAll('.launchpad-item');
                    launchpadItems.forEach(item => {
                        item.removeEventListener('mouseenter', handleMouseEnter);
                        item.removeEventListener('mouseleave', handleMouseLeave);
                        item.addEventListener('mouseenter', handleMouseEnter);
                        item.addEventListener('mouseleave', handleMouseLeave);
                    });
                }
                
                // å¤„ç†å…¶ä»–äº¤äº’å…ƒç´ 
                interactiveElements.forEach(element => {
                    element.removeEventListener('mouseenter', handleMouseEnter);
                    element.removeEventListener('mouseleave', handleMouseLeave);
                    element.addEventListener('mouseenter', handleMouseEnter);
                    element.addEventListener('mouseleave', handleMouseLeave);
                });
            };
            
            // é¼ æ ‡è¿›å…¥å¤„ç†
            const handleMouseEnter = () => {
                // å¼€å¯é¼ æ ‡ç›‘å¬
                ipcRenderer.send('set-ignore-mouse-events', { ignore: false });
            };
            
            // é¼ æ ‡ç¦»å¼€å¤„ç†
            const handleMouseLeave = () => {
                // å…³é—­é¼ æ ‡ç›‘å¬
                ipcRenderer.send('set-ignore-mouse-events', { 
                    ignore: true,
                    forward: true
                });
            };
            
            // åˆå§‹æ›´æ–°äº¤äº’å…ƒç´ 
            updateInteractiveElements();
            
            // ç›‘å¬DOMå˜åŒ–ï¼ŒåŠ¨æ€æ›´æ–°äº¤äº’å…ƒç´ 
            const observer = new MutationObserver(() => {
                updateInteractiveElements();
            });
            
            observer.observe(contentContainer, {
                childList: true,
                subtree: true
            });
        }
        
        // è®¾ç½®IPCäº‹ä»¶ç›‘å¬å™¨
        function setupIpcListeners() {
            // ç›‘å¬ä½œä¸šæ•°æ®
            ipcRenderer.on('homework-data', (event, homeworkData) => {
                renderHomeworkList(homeworkData);
            });
            
            // ç›‘å¬åˆ·æ–°ä½œä¸šåˆ—è¡¨
            ipcRenderer.on('refresh-homework-list', () => {
                loadHomeworkData();
            });
            
            // ç›‘å¬å¤§å±è®¾ç½®
            ipcRenderer.on('big-screen-settings', (event, settings) => {
                if (settings.fontSize) {
                    currentFontSize = settings.fontSize;
                    updateFontSize();
                }
                if (settings.columns) {
                    currentColumns = settings.columns;
                    updateColumns();
                }
                if (settings.opacity) {
                    currentOpacity = settings.opacity;
                    updateOpacity();
                }
                if (settings.blur) {
                    document.documentElement.style.setProperty('--blur-value', `${settings.blur}px`);
                }
                if (settings.style) {
                    currentStyle = settings.style;
                    // é‡æ–°æ¸²æŸ“ä½œä¸šåˆ—è¡¨ä»¥åº”ç”¨æ–°æ ·å¼
                    loadHomeworkData();
                }

            });
            
            // ç›‘å¬å­—å·å˜åŒ–
            ipcRenderer.on('update-big-screen-font-size', (event, fontSize) => {
                currentFontSize = fontSize;
                updateFontSize();
            });
            
            // ç›‘å¬åˆ—æ•°å˜åŒ–
            ipcRenderer.on('update-big-screen-columns', (event, columns) => {
                currentColumns = columns;
                updateColumns();
            });
            
            // ç›‘å¬é€æ˜åº¦å˜åŒ–
            ipcRenderer.on('update-big-screen-opacity', (event, opacity) => {
                currentOpacity = opacity;
                updateOpacity();
            });
            
            // ç›‘å¬æ ·å¼å˜åŒ–
            ipcRenderer.on('update-big-screen-style', (event, style) => {
                currentStyle = style;
                // é‡æ–°æ¸²æŸ“ä½œä¸šåˆ—è¡¨ä»¥åº”ç”¨æ–°æ ·å¼
                ipcRenderer.send('get-homework-data');
            });

            
            // ç›‘å¬èƒŒæ™¯æ¨¡ç³Šå˜åŒ–
            ipcRenderer.on('update-big-screen-blur', (event, blurValue) => {
                document.documentElement.style.setProperty('--blur-value', `${blurValue}px`);
            });
            
            // ç›‘å¬æš—è‰²ä¸»é¢˜åˆ‡æ¢
            ipcRenderer.on('dark-theme-toggle', (event, isEnabled) => {
                if (isEnabled) {
                    document.body.classList.add('dark-theme');
                } else {
                    document.body.classList.remove('dark-theme');
                }
                updateOpacity();
                updateCardOpacity();
            });
        }
        

        
        // åŠ è½½ä½œä¸šæ•°æ®
        function loadHomeworkData() {
            // ä¸»åŠ¨è¯·æ±‚ä½œä¸šæ•°æ®
            ipcRenderer.send('get-homework-data');
        }
        
        // æ¸²æŸ“ä½œä¸šåˆ—è¡¨
        function renderHomeworkList(homeworkData) {
            const grid = document.getElementById('homeworkGrid');
            grid.innerHTML = '';
            grid.className = 'sticky-homeworks-grid';
            
            if (!homeworkData || homeworkData.length === 0) {
                grid.innerHTML = '<div class="no-homework">æš‚æ— ä½œä¸š</div>';
                return;
            }
            
            // ä½¿ç”¨æ–‡æ¡£ç‰‡æ®µå‡å°‘DOMæ“ä½œ
            const fragment = document.createDocumentFragment();
            
            // æŒ‰ç§‘ç›®åˆ†ç»„
            const homeworkBySubject = homeworkData.reduce((groups, item) => {
                const subject = item.subject;
                if (!groups[subject]) {
                    groups[subject] = [];
                }
                groups[subject].push(item);
                return groups;
            }, {});
            
            // éå†æ¯ä¸ªç§‘ç›®
            Object.entries(homeworkBySubject).forEach(([subject, items]) => {
                // ç§‘ç›®åŒºåŸŸ
                const subjectSection = document.createElement('div');
                subjectSection.className = `sticky-subject-section ${subject}`;
                
                // ç§‘ç›®æ ‡é¢˜
                const subjectTitle = document.createElement('div');
                subjectTitle.className = 'sticky-subject-title';
                subjectTitle.textContent = getSubjectName(subject);
                subjectSection.appendChild(subjectTitle);
                
                // ä½œä¸šåˆ—è¡¨
                const homeworkList = document.createElement('div');
                homeworkList.className = 'sticky-homework-list';
                
                // ä½œä¸šé¡¹
                items.forEach(item => {
                    const homeworkItem = document.createElement('div');
                    homeworkItem.className = 'sticky-homework-item';
                    
                    // æ ¼å¼åŒ–æˆªæ­¢æ—¥æœŸ
                    let dueDateStr = '';
                    if (item.dueDate) {
                        const date = new Date(item.dueDate);
                        const today = new Date();
                        if (date.getFullYear() === today.getFullYear() &&
                            date.getMonth() === today.getMonth() &&
                            date.getDate() === today.getDate()) {
                            dueDateStr = ' <span class="due-date today">ä»Šå¤©æˆªæ­¢</span>';
                        } else {
                            dueDateStr = ` <span class="due-date">æˆªæ­¢: ${date.getFullYear()}-${String(date.getMonth()+1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}</span>`;
                        }
                    }
                    
                    // ä½œä¸šå†…å®¹
                    const contentWithLineBreaks = item.content.replace(/\n/g, '<br>');
                    
                    homeworkItem.innerHTML = `${contentWithLineBreaks}${dueDateStr}`;
                    homeworkList.appendChild(homeworkItem);
                });
                
                subjectSection.appendChild(homeworkList);
                fragment.appendChild(subjectSection);
            });
            
            // ä¸€æ¬¡æ€§æ·»åŠ æ‰€æœ‰å…ƒç´ 
            grid.appendChild(fragment);
        }
        
        // è·å–ç§‘ç›®åç§°
        function getSubjectName(subjectValue) {
            const subjects = {
                'chinese': 'è¯­æ–‡',
                'math': 'æ•°å­¦',
                'english': 'è‹±è¯­',
                'physics': 'ç‰©ç†',
                'chemistry': 'åŒ–å­¦',
                'biology': 'ç”Ÿç‰©',
                'history': 'å†å²',
                'geography': 'åœ°ç†',
                'politics': 'é“æ³•',
                'other': 'å…¶ä»–'
            };
            return subjects[subjectValue] || subjectValue;
        }
        
        // æ›´æ–°å­—å·
        function updateFontSize() {
            document.documentElement.style.setProperty('--font-size', `${currentFontSize}px`);
            localStorage.setItem('bigScreenFontSize', currentFontSize.toString());
        }
        
        // æ›´æ–°åˆ—æ•°
        function updateColumns() {
            // ç§»é™¤æ‰€æœ‰åˆ—æ•°ç›¸å…³çš„ç±»
            document.body.classList.remove('columns-1', 'columns-2', 'columns-3', 'columns-4', 'columns-auto');
            // æ·»åŠ å½“å‰åˆ—æ•°çš„ç±»
            document.body.classList.add(`columns-${currentColumns}`);
            localStorage.setItem('bigScreenColumns', currentColumns);
        }
        
        // æ›´æ–°é€æ˜åº¦
        function updateOpacity() {
            const isDarkTheme = document.body.classList.contains('dark-theme');
            
            if (isDarkTheme) {
                // æš—è‰²ä¸»é¢˜
                document.documentElement.style.setProperty('--background-color', `rgba(32, 31, 30, ${currentOpacity / 100})`);
                document.documentElement.style.setProperty('--title-bar-bg', `rgba(37, 37, 38, ${currentOpacity / 100})`);
                document.documentElement.style.setProperty('--card-bg', `rgba(50, 49, 48, ${currentOpacity / 100})`);
            } else {
                // äº®è‰²ä¸»é¢˜
                document.documentElement.style.setProperty('--background-color', `rgba(255, 255, 255, ${currentOpacity / 100})`);
                document.documentElement.style.setProperty('--title-bar-bg', `rgba(243, 242, 241, ${currentOpacity / 100})`);
                document.documentElement.style.setProperty('--card-bg', `rgba(255, 255, 255, ${currentOpacity / 100})`);
            }
            
            localStorage.setItem('bigScreenOpacity', currentOpacity.toString());
            
            // å¦‚æœä½œä¸šå¡ç‰‡é€æ˜åº¦è·Ÿéšçª—å£é€æ˜åº¦ï¼ŒåŒæ­¥æ›´æ–°ä½œä¸šå¡ç‰‡é€æ˜åº¦
            if (isCardOpacityFollow) {
                currentCardOpacity = currentOpacity;
                updateCardOpacity();
            }
        }
        
        // æ›´æ–°ä½œä¸šå¡ç‰‡é€æ˜åº¦
        function updateCardOpacity() {
            document.documentElement.style.setProperty('--card-opacity', `${currentCardOpacity / 100}`);
            localStorage.setItem('homeworkCardOpacity', currentCardOpacity.toString());
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>