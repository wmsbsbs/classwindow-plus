<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>è®¾ç½® - è¯¾å ‚çª—</title>
    <!-- å¼•å…¥ Fluent UI Web Components -->
    <script type="module" src="https://unpkg.com/@fluentui/web-components"></script>
    <link rel="stylesheet" href="../assets/css/settings.css">
    </link>
    <link rel="stylesheet" href="../assets/css/hide-scrollbar.css">
    </link>
</head>

<body>
    <!-- æ ‡é¢˜æ  -->
    <div class="title-bar">
        <div class="title">è®¾ç½®</div>
        <div class="title-bar-buttons">
            <fluent-button id="titleCloseBtn" appearance="stealth" aria-label="å…³é—­">
                <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </fluent-button>
        </div>
    </div>

    <div class="container">
        <div class="settings-layout">
            <!-- å·¦ä¾§é€‰é¡¹å¡ -->
            <div class="sidebar">
                <fluent-card class="tab active" data-tab="general">
                    <fluent-badge appearance="accent">âš™ï¸</fluent-badge>
                    <span>å¸¸è§„</span>
                </fluent-card>
                <fluent-card class="tab" data-tab="appearance">
                    <fluent-badge appearance="accent">ğŸ¨</fluent-badge>
                    <span>å¤–è§‚</span>
                </fluent-card>
                <fluent-card class="tab" data-tab="launchpad">
                    <fluent-badge appearance="accent">ğŸš€</fluent-badge>
                    <span>å¯åŠ¨å°</span>
                </fluent-card>
                <fluent-card class="tab" data-tab="advanced">
                    <fluent-badge appearance="accent">ğŸ”§</fluent-badge>
                    <span>é«˜çº§</span>
                </fluent-card>
            </div>

            <!-- å³ä¾§å†…å®¹åŒºåŸŸ -->
            <div class="content">
                <!-- å¸¸è§„è®¾ç½® -->
                <div class="tab-content active" id="general-tab">
                    <fluent-card class="setting-group">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-title">å¯ç”¨æ—¶é’Ÿ</div>
                                <div class="setting-description">åœ¨ä¸»çª—å£æ˜¾ç¤ºæ—¶é’ŸåŠŸèƒ½</div>
                            </div>
                            <div class="actions">
                                <fluent-switch id="clockToggle" label="æ—¶é’Ÿ"></fluent-switch>
                            </div>
                        </div>

                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-title">å¯ç”¨ä½œä¸š</div>
                                <div class="setting-description">åœ¨ä¸»çª—å£æ˜¾ç¤ºä½œä¸šåŠŸèƒ½</div>
                            </div>
                            <div class="actions">
                                <fluent-switch id="homeworkToggle" label="ä½œä¸š"></fluent-switch>
                            </div>
                        </div>
                    </fluent-card>
                </div>

                <!-- å¤–è§‚è®¾ç½® -->
                <div class="tab-content" id="appearance-tab">
                    <fluent-card class="setting-group">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-title">ä½¿ç”¨æš—è‰²ä¸»é¢˜</div>
                                <div class="setting-description">å¯ç”¨æ·±è‰²æ¨¡å¼ï¼Œä½¿ç”¨é»‘è‰²èƒŒæ™¯</div>
                            </div>
                            <div class="actions">
                                <fluent-switch id="darkThemeToggle" label="æš—è‰²ä¸»é¢˜"></fluent-switch>
                            </div>
                        </div>

                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-title">çª—å£ç½®é¡¶</div>
                                <div class="setting-description">ä¸»çª—å£å§‹ç»ˆä¿æŒåœ¨æœ€å‰ç«¯</div>
                            </div>
                            <div class="actions">
                                <fluent-switch id="alwaysOnTopToggle" label="ç½®é¡¶"></fluent-switch>
                            </div>
                        </div>
                    </fluent-card>
                </div>

                <!-- å¯åŠ¨å°è®¾ç½® -->
                <div class="tab-content" id="launchpad-tab">
                    <fluent-card class="setting-group">
                        <div class="launchpad-header">
                            <div class="launchpad-title">å¯åŠ¨å°</div>
                        </div>
                        <p class="launchpad-description">ç®¡ç†å¿«æ·å¯åŠ¨çš„åº”ç”¨ç¨‹åºå’Œé“¾æ¥</p>

                        <div class="launchpad-list" id="launchpadList">
                            <!-- å¯åŠ¨é¡¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                        </div>

                        <div class="add-form">
                            <div class="form-row">
                                <fluent-text-field id="appNameInput" placeholder="åç§°" class="add-input"></fluent-text-field>
                                <fluent-select id="appTypeInput" class="type-selector">
                                    <fluent-option value="app">åº”ç”¨ç¨‹åº</fluent-option>
                                    <fluent-option value="link">é“¾æ¥</fluent-option>
                                </fluent-select>
                            </div>
                            <fluent-text-field id="appPathInput" placeholder="åº”ç”¨ç¨‹åºè·¯å¾„æˆ–é“¾æ¥åœ°å€" class="add-input"></fluent-text-field>
                            <fluent-text-field id="appIconInput" placeholder="å›¾æ ‡è·¯å¾„ï¼ˆå¯é€‰ï¼‰" class="add-input"></fluent-text-field>
                            <fluent-button id="addAppBtn" appearance="accent" class="add-btn">æ·»åŠ </fluent-button>
                        </div>
                    </fluent-card>
                </div>

                <!-- é«˜çº§è®¾ç½® -->
                <div class="tab-content" id="advanced-tab">
                    <fluent-card class="setting-group">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-title">å¼€æœºè‡ªå¯</div>
                                <div class="setting-description">ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œåº”ç”¨</div>
                            </div>
                            <div class="actions">
                                <fluent-switch id="startupToggle" label="å¼€æœºè‡ªå¯"></fluent-switch>
                            </div>
                        </div>
                    </fluent-card>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { ipcRenderer } = require('electron');

        // é¡µé¢åŠ è½½å®Œæˆåè·å–å½“å‰è®¾ç½®çŠ¶æ€
        window.addEventListener('DOMContentLoaded', () => {
            // è¯·æ±‚è·å–å½“å‰è®¾ç½®
            ipcRenderer.send('get-settings');
        });

        // ç›‘å¬è®¾ç½®çŠ¶æ€æ›´æ–°
        ipcRenderer.on('settings-updated', (event, settings) => {
            document.querySelector('#clockToggle').checked = settings.clockEnabled;
            document.querySelector('#homeworkToggle').checked = settings.homeworkEnabled;
            document.querySelector('#alwaysOnTopToggle').checked = settings.alwaysOnTop; // ç½®é¡¶çŠ¶æ€
            document.querySelector('#darkThemeToggle').checked = settings.darkThemeEnabled || false; // æš—è‰²ä¸»é¢˜çŠ¶æ€
            document.querySelector('#startupToggle').checked = settings.startupEnabled || false; // å¼€æœºè‡ªå¯çŠ¶æ€

            // æ¸²æŸ“å¯åŠ¨å°åº”ç”¨åˆ—è¡¨
            renderLaunchpadList(settings.launchpadApps || []);
        });

        // ç›‘å¬æ—¶é’Ÿå¼€å…³å˜åŒ–
        document.querySelector('#clockToggle').addEventListener('change', function () {
            ipcRenderer.send('toggle-clock', this.checked);
        });

        // ç›‘å¬ä½œä¸šå¼€å…³å˜åŒ–
        document.querySelector('#homeworkToggle').addEventListener('change', function () {
            ipcRenderer.send('toggle-homework', this.checked);
        });

        // ç›‘å¬ç½®é¡¶å¼€å…³å˜åŒ–
        document.querySelector('#alwaysOnTopToggle').addEventListener('change', function () {
            ipcRenderer.send('toggle-always-on-top', this.checked);
        });

        // ç›‘å¬æš—è‰²ä¸»é¢˜å¼€å…³å˜åŒ–
        document.querySelector('#darkThemeToggle').addEventListener('change', function () {
            ipcRenderer.send('toggle-dark-theme', this.checked);
        });

        // ç›‘å¬å¼€æœºè‡ªå¯å¼€å…³å˜åŒ–
        document.querySelector('#startupToggle').addEventListener('change', function () {
            ipcRenderer.send('toggle-startup', this.checked);
        });

        // æ·»åŠ å¯åŠ¨å°åº”ç”¨
        document.querySelector('#addAppBtn').addEventListener('click', function () {
            const nameInput = document.getElementById('appNameInput');
            const pathInput = document.getElementById('appPathInput');
            const typeInput = document.getElementById('appTypeInput');
            const iconInput = document.getElementById('appIconInput'); // æ–°å¢å›¾æ ‡è¾“å…¥

            const name = nameInput.value.trim();
            const path = pathInput.value.trim();
            const type = typeInput.value;
            const icon = iconInput.value.trim(); // è·å–å›¾æ ‡è·¯å¾„

            if (!name || !path) {
                alert('è¯·è¾“å…¥åç§°å’Œè·¯å¾„/é“¾æ¥');
                return;
            }

            // å¦‚æœæ˜¯é“¾æ¥ç±»å‹ï¼ŒéªŒè¯URLæ ¼å¼
            if (type === 'link' && !isValidUrl(path)) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„é“¾æ¥åœ°å€ï¼ˆä»¥http://æˆ–https://å¼€å¤´ï¼‰');
                return;
            }

            // å‘é€åŒ…å«å›¾æ ‡ä¿¡æ¯çš„åº”ç”¨æ•°æ®
            ipcRenderer.send('add-launchpad-app', {
                name,
                path,
                type,
                icon: icon || null // å¦‚æœæ²¡æœ‰æä¾›å›¾æ ‡ï¼Œåˆ™ä¸ºnull
            });

            // æ¸…ç©ºè¾“å…¥æ¡†
            nameInput.value = '';
            pathInput.value = '';
            iconInput.value = ''; // æ¸…ç©ºå›¾æ ‡è¾“å…¥æ¡†
        });

        // éªŒè¯URLæ ¼å¼
        function isValidUrl(string) {
            try {
                const url = new URL(string);
                return url.protocol === 'http:' || url.protocol === 'https:';
            } catch (_) {
                return false;
            }
        }


        // åˆ é™¤å¯åŠ¨å°åº”ç”¨
        function removeLaunchpadApp(index) {
            ipcRenderer.send('remove-launchpad-app', index);
        }

        // æ¸²æŸ“å¯åŠ¨å°åº”ç”¨åˆ—è¡¨
        function renderLaunchpadList(apps) {
            const listContainer = document.getElementById('launchpadList');
            listContainer.innerHTML = '';

            if (apps.length === 0) {
                listContainer.innerHTML = '<p style="text-align: center; color: #605e5c; padding: 10px;">æš‚æ— å¯åŠ¨é¡¹</p>';
                return;
            }

            apps.forEach((app, index) => {
                const item = document.createElement('div');
                item.className = 'launchpad-item';

                const typeLabel = app.type === 'link' ? 'é“¾æ¥' : 'åº”ç”¨';
                const typeClass = app.type === 'link' ? 'link' : 'app';

                item.innerHTML = `
                    <div class="launchpad-item-info">
                        <div class="launchpad-item-name">
                            ${app.name}
                            <fluent-badge appearance="accent" size="small" class="launchpad-item-type" data-type="${typeClass}">${typeLabel}</fluent-badge>
                        </div>
                        <div class="launchpad-item-path">${app.path}</div>
                    </div>
                    <div class="launchpad-item-actions">
                        <fluent-button appearance="lightweight" class="remove-btn" onclick="removeLaunchpadApp(${index})">åˆ é™¤</fluent-button>
                    </div>
                `;
                listContainer.appendChild(item);
            });
        }

        // ç›‘å¬å¯åŠ¨å°åº”ç”¨æ›´æ–°
        ipcRenderer.on('launchpad-apps-updated', (event, apps) => {
            renderLaunchpadList(apps);
        });

        // é€‰é¡¹å¡åˆ‡æ¢åŠŸèƒ½
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

                // æ·»åŠ å½“å‰æ´»åŠ¨çŠ¶æ€
                tab.classList.add('active');
                const tabId = `${tab.dataset.tab}-tab`;
                document.getElementById(tabId).classList.add('active');
            });
        });

        // ç›‘å¬å…³é—­æŒ‰é’®
        document.querySelector('#titleCloseBtn').addEventListener('click', () => {
            window.close();
        });

        // ä½¿ removeLaunchpadApp å‡½æ•°å…¨å±€å¯ç”¨
        window.removeLaunchpadApp = removeLaunchpadApp;
    </script>
</body>

</html>