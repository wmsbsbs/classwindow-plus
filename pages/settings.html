<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>设置 - 课堂窗</title>
    <link rel="stylesheet" href="../assets/css/settings.css"></link>
    <link rel="stylesheet" href="../assets/css/hide-scrollbar.css"></link>
    <style>
        /* 基础样式 */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }
        
        html {
            height: 100%;
            width: 100%;
            overflow: hidden;
        }
        
        /* 标题栏 */
        .title-bar {
            height: 32px;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 10px;
            -webkit-app-region: drag;
            border-bottom: 1px solid #d9d9d9;
        }
        
        .title {
            font-size: 14px;
            font-weight: bold;
            color: #333;
        }
        
        .title-bar-buttons {
            display: flex;
            gap: 5px;
            -webkit-app-region: no-drag;
        }
        
        .title-bar-button {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 1px solid transparent;
            cursor: pointer;
        }
        
        .close-button {
            background-color: #ff5f57;
        }
        
        /* 主容器 */
        .container {
            display: flex;
            height: calc(100vh - 32px);
            overflow: hidden;
            background-color: #f5f5f5;
            margin-top: 32px; /* 为标题栏留出空间 */
        }
        
        /* 侧边栏 */
        .sidebar {
            width: 200px;
            background-color: white;
            border-radius: 8px;
            margin: 20px;
            margin-right: 12px;
            display: flex;
            flex-direction: column;
            transition: width 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }
        
        .sidebar.collapsed {
            width: 60px;
            margin: 20px;
            margin-right: 12px;
        }
        
        .sidebar-toggle {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
            color: #666;
            transition: transform 0.3s ease;
            z-index: 1000;
            background-color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .sidebar-toggle.collapsed {
            transform: rotate(180deg);
        }
        
        .sidebar.collapsed .sidebar-toggle {
            right: 50%;
            transform: translateX(50%) rotate(180deg);
        }
        
        .sidebar.collapsed .sidebar-toggle:not(.collapsed) {
            right: 50%;
            transform: translateX(50%);
        }
        
        .nav-menu {
            padding: 20px 0;
            flex: 1;
        }
        
        .nav-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            border-radius: 0 16px 16px 0;
            margin-right: 8px;
        }
        
        .nav-item:hover {
            background-color: #f0f7ff;
        }
        
        .nav-item.active {
            background-color: #e1f0ff;
        }
        
        /* 导航指示器 */
        .nav-indicator {
            position: absolute;
            left: 0;
            top: 0;
            width: 3px;
            background-color: #0078d4;
            border-radius: 0 3px 3px 0;
            transition: all 0.3s ease;
            z-index: 100;
        }
        
        .nav-item-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .nav-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            color: #0078d4;
        }
        
        .nav-icon svg {
            width: 20px;
            height: 20px;
            fill: none;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        
        .nav-text {
            font-size: 14px;
            font-weight: 500;
            flex: 1;
        }
        
        .sidebar.collapsed .nav-text {
            display: none;
        }
        
        .sidebar.collapsed .nav-icon {
            margin: 0 auto;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .sidebar.collapsed .nav-item-content {
            justify-content: center;
            display: flex;
            align-items: center;
            width: 100%;
        }
        
        .sidebar.collapsed .nav-item {
            padding: 12px 0;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* 子菜单 */
        .sub-nav {
            margin-left: 36px;
            margin-top: 8px;
            display: none;
        }
        
        .nav-item.expanded .sub-nav {
            display: block;
        }
        
        .sidebar.collapsed .sub-nav {
            display: none !important;
        }
        
        .sub-nav-item {
            padding: 8px 16px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 4px;
            margin-bottom: 4px;
        }
        
        .sub-nav-item:hover {
            background-color: #f0f7ff;
        }
        
        .sub-nav-item.active {
            background-color: #0078d4;
            color: white;
        }
        
        /* 主内容区域 */
        .main-content {
            flex: 1;
            padding: 0;
            overflow-y: auto;
            background-color: white;
            box-sizing: border-box;
            margin: 20px 20px 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        /* 确保所有卡片都有完整的圆角 */
        .main-content,
        .sidebar,
        .setting-section,
        .launchpad-item,
        .template-item,
        .add-form {
            border-radius: 8px;
            overflow: hidden;
        }
        
        /* 恢复圆角样式 */
        /* 侧边栏 */
        .sidebar {
            width: 200px;
            background-color: white;
            border-radius: 8px;
            margin: 20px;
            margin-right: 12px;
            display: flex;
            flex-direction: column;
            transition: width 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }
        
        .sidebar.collapsed {
            width: 60px;
            margin: 20px;
            margin-right: 12px;
        }
        
        /* 主内容区域 */
        .main-content {
            flex: 1;
            padding: 0;
            overflow-y: auto;
            background-color: white;
            box-sizing: border-box;
            margin: 20px 20px 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        /* 确保窗口整体美观 */
        body {
            overflow: hidden;
        }
        
        /* 模板管理特殊样式 */
        .template-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
            padding: 20px;
            margin: 0;
            width: 100%;
            min-width: 0;
            box-sizing: border-box;
        }
        
        .template-item {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            width: 100%;
            min-width: 0;
            margin: 0;
            box-sizing: border-box;
        }
        
        /* 确保模板管理区域的父容器宽度正确 */
        #templates {
            width: 100%;
            min-width: 0;
            box-sizing: border-box;
        }
        
        #templates .setting-section {
            width: 100%;
            min-width: 0;
            box-sizing: border-box;
        }
        
        /* 确保主内容区域和容器有正确的宽度设置 */
        .main-content {
            width: 100%;
            min-width: 0;
            box-sizing: border-box;
        }
        
        .container {
            width: 100%;
            min-width: 0;
            box-sizing: border-box;
        }
        
        /* 确保模板项内部元素正确显示 */
        .template-item > div:first-child {
            width: 100%;
            min-width: 0;
            box-sizing: border-box;
        }
        
        .template-item > div:first-child > div:first-child {
            width: 100%;
            min-width: 0;
            box-sizing: border-box;
        }
        
        .template-info {
            flex: 1;
            width: 100%;
        }
        
        .template-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .template-description {
            font-size: 14px;
            color: #666;
            margin-bottom: 12px;
            line-height: 1.4;
        }
        
        .template-actions {
            display: flex;
            gap: 8px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .sub-tab-content {
            display: none;
        }
        
        .sub-tab-content.active {
            display: block;
        }
        
        /* 设置部分 */
        .setting-section {
            background-color: transparent;
            border-radius: 8px;
            padding: 20px;
            margin: 0;
            box-shadow: none;
        }
        
        .setting-section h2 {
            font-size: 20px;
            font-weight: 600;
            margin: 0 0 20px 0;
            color: #333;
        }
        
        /* 启动台样式 */
        .launchpad-list {
            margin: 0;
            padding: 20px;
            min-height: 200px;
            background-color: transparent;
            border: none;
            border-radius: 0;
        }
        
        .launchpad-item {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 16px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            width: 100%;
        }
        
        .add-form {
            margin: 0 20px 20px 20px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        

        
        /* 关于页面样式 */
        .about-section {
            padding: 20px;
            margin: 0;
        }
        
        .setting-group {
            margin-bottom: 24px;
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .setting-item:last-child {
            border-bottom: none;
        }
        
        .setting-info {
            flex: 1;
        }
        
        .setting-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 4px;
            color: #333;
        }
        
        .setting-description {
            font-size: 13px;
            color: #666;
        }
        
        .actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        /* 启动台样式 */
        .launchpad-list {
            margin: 20px 0;
            padding: 0;
            min-height: 200px;
            background-color: transparent;
            border: none;
            border-radius: 0;
        }
        
        .launchpad-item {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            margin-bottom: 16px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            width: 100%;
        }
        
        .launchpad-item:last-child {
            margin-bottom: 0;
        }
        
        .app-info {
            flex: 1;
            width: 100%;
        }
        
        .app-name {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .app-path {
            font-size: 14px;
            color: #666;
            word-break: break-all;
            margin-bottom: 12px;
        }
        
        .add-form {
            margin-top: 20px;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        /* 输入控件样式 */
        select, input[type="text"] {
            padding: 8px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            font-size: 14px;
            background-color: white;
            cursor: pointer;
            transition: border-color 0.2s ease;
        }
        
        select:hover, input[type="text"]:hover {
            border-color: #0078d4;
        }
        
        input[type="range"] {
            width: 150px;
            cursor: pointer;
        }
        
        button {
            padding: 8px 16px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        button:hover {
            background-color: #f5f5f5;
        }
        
        button.primary {
            background-color: #0078d4;
            color: white;
            border-color: #0078d4;
        }
        
        button.primary:hover {
            background-color: #005a9e;
        }
        
        /* 开关样式 */
        .toggle-switch {
            position: relative;
            width: 48px;
            height: 24px;
            background-color: #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .toggle-switch.active {
            background-color: #0078d4;
        }
        
        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background-color: white;
            border-radius: 50%;
            transition: transform 0.2s ease;
        }
        
        .toggle-switch.active::after {
            transform: translateX(24px);
        }
        
        /* 启动台样式 */
        .launchpad-list {
            margin: 20px 0;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 16px;
            min-height: 200px;
            background-color: #fafafa;
        }
        
        .launchpad-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background-color: white;
            border-radius: 8px;
            margin-bottom: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        
        .launchpad-item:last-child {
            margin-bottom: 0;
        }
        
        .app-info {
            flex: 1;
        }
        
        .app-name {
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .app-path {
            font-size: 12px;
            color: #666;
            word-break: break-all;
        }
        
        .add-form {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .form-row {
            display: flex;
            gap: 12px;
        }
        
        .add-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .type-selector {
            padding: 8px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            font-size: 14px;
            min-width: 120px;
        }
        
        /* 关于页面 */
        .about-section {
            text-align: center;
            padding: 40px 20px;
        }
        
        .header-section {
            margin-bottom: 40px;
        }
        
        .header-section img {
            width: 100px;
            height: 100px;
            border-radius: 20px;
            margin-bottom: 20px;
        }
        
        .app-name {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .slogan {
            font-size: 16px;
            color: #666;
            margin-bottom: 20px;
        }
        
        .info-card {
            background-color: white;
            border-radius: 8px;
            padding: 24px;
            margin: 0 auto;
            max-width: 400px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .about-content {
            margin-bottom: 20px;
        }
        
        .about-text {
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .footer {
            margin-top: 40px;
            font-size: 12px;
            color: #666;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .sidebar {
                width: 200px;
            }
            
            .main-content {
                padding: 10px;
            }
            
            .setting-section {
                padding: 16px;
            }
            
            .setting-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
            
            .actions {
                width: 100%;
                justify-content: flex-end;
            }
        }
    </style>
</head>
<body>
    <!-- 标题栏 -->
    <div class="title-bar">
        <div class="title">设置</div>
        <div class="title-bar-buttons">
            <div class="title-bar-button close-button" id="titleCloseBtn"></div>
        </div>
    </div>

    <div class="container">
        <!-- 侧边栏 -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-toggle" id="sidebarToggle">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
            </div>
            <div class="nav-indicator" id="navIndicator"></div>
            <nav class="nav-menu">
                <div class="nav-item active" data-tab="appearance">
                    <div class="nav-item-content">
                        <div class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"></path>
                                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                            </svg>
                        </div>
                        <div class="nav-text">外观设置</div>
                    </div>
                </div>
                <div class="nav-item" data-tab="big-screen">
                    <div class="nav-item-content">
                        <div class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                                <line x1="8" y1="21" x2="16" y2="21"></line>
                                <line x1="12" y1="17" x2="12" y2="21"></line>
                            </svg>
                        </div>
                        <div class="nav-text">大屏模式设置</div>
                    </div>
                </div>
                <div class="nav-item" data-tab="window">
                    <div class="nav-item-content">
                        <div class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="3" y1="9" x2="21" y2="9"></line>
                                <line x1="9" y1="21" x2="9" y2="9"></line>
                            </svg>
                        </div>
                        <div class="nav-text">窗口设置</div>
                    </div>
                </div>
                <div class="nav-item" data-tab="cloud">
                    <div class="nav-item-content">
                        <div class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M18 10h-4V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v6H6a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8a2 2 0 0 0-2-2z"></path>
                            </svg>
                        </div>
                        <div class="nav-text">云端同步设置</div>
                    </div>
                </div>
                <div class="nav-item" data-tab="operations">
                    <div class="nav-item-content">
                        <div class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                            </svg>
                        </div>
                        <div class="nav-text">系统操作</div>
                    </div>
                </div>
                <div class="nav-item" data-tab="ci-integration">
                    <div class="nav-item-content">
                        <div class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M18 16v3a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h3m4 0H9M14 10l4-4m0 0l4 4m-4-4v12"></path>
                            </svg>
                        </div>
                        <div class="nav-text">CI联动设置</div>
                    </div>
                </div>
                <div class="nav-item" data-tab="launchpad">
                    <div class="nav-item-content">
                        <div class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="3" y1="9" x2="21" y2="9"></line>
                                <line x1="9" y1="21" x2="9" y2="9"></line>
                            </svg>
                        </div>
                        <div class="nav-text">启动台</div>
                    </div>
                </div>
                <div class="nav-item" data-tab="templates">
                    <div class="nav-item-content">
                        <div class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"></path>
                                <path d="M16 2v4"></path>
                                <path d="M8 2v4"></path>
                                <path d="M3 10h18"></path>
                            </svg>
                        </div>
                        <div class="nav-text">模板管理</div>
                    </div>
                </div>
                <div class="nav-item" data-tab="about">
                    <div class="nav-item-content">
                        <div class="nav-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
                                <line x1="9" y1="9" x2="9.01" y2="9"></line>
                                <line x1="15" y1="9" x2="15.01" y2="9"></line>
                            </svg>
                        </div>
                        <div class="nav-text">关于</div>
                    </div>
                </div>
            </nav>
        </div>
        
        <!-- 主内容区域 -->
        <div class="main-content">
            <!-- 外观设置 -->
            <div class="tab-content active" id="appearance">
                <div class="setting-section">
                    <h2>外观设置</h2>
                    <div class="setting-group">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-title">主题选择</div>
                                <div class="setting-description">选择作业显示模式：个人模式或大屏模式</div>
                            </div>
                            <div class="actions">
                                <select id="themeSelect">
                                    <option value="personal">个人模式</option>
                                    <option value="big-screen">大屏模式</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 大屏模式设置 -->
            <div class="tab-content" id="big-screen">
                <div class="setting-section">
                    <h2>大屏模式设置</h2>
                    <div class="setting-group">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-title">大屏模式列数</div>
                                <div class="setting-description">调整大屏模式作业列表的列数</div>
                            </div>
                            <div class="actions">
                                <select id="bigScreenColumnsSelect">
                                    <option value="1">1列</option>
                                    <option value="2">2列</option>
                                    <option value="3">3列</option>
                                    <option value="4">4列</option>
                                    <option value="auto">自适应</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-title">大屏模式字号</div>
                                <div class="setting-description">调整大屏模式作业内容的字号</div>
                            </div>
                            <div class="actions">
                                <input type="range" 
                                    id="bigScreenFontSizeSlider" 
                                    min="10" 
                                    max="48" 
                                    step="1" 
                                    value="14">
                                <span id="bigScreenFontSizeValue">14</span>px
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-title">大屏模式不透明度</div>
                                <div class="setting-description">调整大屏模式窗口的不透明度</div>
                            </div>
                            <div class="actions">
                                <input type="range" 
                                    id="bigScreenOpacitySlider" 
                                    min="10" 
                                    max="100" 
                                    step="1" 
                                    value="95">
                                <span id="bigScreenOpacityValue">95</span>%
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-title">大屏模式样式</div>
                                <div class="setting-description">选择大屏模式的作业显示样式</div>
                            </div>
                            <div class="actions">
                                <select id="bigScreenStyleSelect">
                                    <option value="classwindow-plus">ClassWindow Plus 样式</option>
                                    <option value="sticky-homeworks2">StickyHomeworks2 样式</option>
                                </select>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            
            <!-- 窗口设置 -->
            <div class="tab-content" id="window">
                <div class="setting-section">
                    <h2>窗口设置</h2>
                    <div class="setting-group">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-title">主窗口显示位置</div>
                                <div class="setting-description">设置主窗口在屏幕上的显示位置</div>
                            </div>
                            <div class="actions">
                                <select id="windowPositionSelect">
                                    <option value="center">屏幕居中</option>
                                    <option value="top-left">屏幕左上</option>
                                    <option value="top-right">屏幕右上</option>
                                    <option value="bottom-right">屏幕右下</option>
                                    <option value="bottom-left">屏幕左下</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-title">主界面组件缩放</div>
                                <div class="setting-description">调整桌面悬浮的时间和作业卡片的大小</div>
                            </div>
                            <div class="actions">
                                <input type="range" 
                                    id="mainInterfaceScaleSlider" 
                                    min="80" 
                                    max="150" 
                                    step="5" 
                                    value="100">
                                <span id="mainInterfaceScaleValue">100%</span>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-title">显示时间</div>
                                <div class="setting-description">在个人模式窗口中显示时间组件</div>
                            </div>
                            <div class="actions">
                                <div class="toggle-switch" id="showClockToggle"></div>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-title">显示作业</div>
                                <div class="setting-description">在个人模式窗口中显示作业组件</div>
                            </div>
                            <div class="actions">
                                <div class="toggle-switch" id="showHomeworkToggle"></div>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-title">显示启动台</div>
                                <div class="setting-description">在个人模式窗口中显示启动台组件</div>
                            </div>
                            <div class="actions">
                                <div class="toggle-switch" id="showLaunchpadToggle"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 云端同步设置 -->
            <div class="tab-content" id="cloud">
                <div class="setting-section">
                    <h2>云端同步设置</h2>
                    <div class="setting-group">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-title">启用云端同步</div>
                                <div class="setting-description">开启作业数据的云端同步功能</div>
                            </div>
                            <div class="actions">
                                <div class="toggle-switch" id="cloudSyncToggle"></div>
                            </div>
                        </div>
                        
                        <div class="setting-item" style="background-color: #f8f9fa; border-radius: 8px; padding: 16px;">
                            <div class="setting-info">
                                <div class="setting-title" style="color: #0078d4;">云端功能使用提示</div>
                                <div class="setting-description" style="color: #666; margin-top: 8px;">
                                    <p>1. 请先选择官方服务器或输入自定义服务器地址</p>
                                    <p>2. 点击"打开账号管理"按钮设置学校代码、班级代码和教师密码</p>
                                    <p>3. 启用云端同步功能后，即可执行同步操作</p>
                                    <p>4. 同步操作会将本地作业数据与云端服务器进行双向同步</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-title">服务器地址</div>
                                <div class="setting-description">云端服务器的地址，格式如 http://your-server.com/homework</div>
                            </div>
                            <div class="actions">
                                <input type="text" id="serverAddressInput" placeholder="http://your-server.com/homework" style="flex: 1; margin-right: 8px;">
                                <select id="serverPresetSelect" style="min-width: 150px;">
                                    <option value="">选择预设</option>
                                    <option value="http://1.12.218.107:345/homework-sync.php">官方服务器</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-title">账号管理</div>
                                <div class="setting-description">管理学校代码、班级代码和教师密码</div>
                            </div>
                            <div class="actions">
                                <button class="primary" id="openAccountManagementBtn">打开账号管理</button>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-title">同步操作</div>
                                <div class="setting-description">手动执行云端同步操作</div>
                            </div>
                            <div class="actions">
                                <button class="primary" id="syncToCloudBtn">同步到云端</button>
                                <button id="syncFromCloudBtn">从云端同步</button>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-title">启用自动同步</div>
                                <div class="setting-description">定期自动执行云端同步操作</div>
                            </div>
                            <div class="actions">
                                <div class="toggle-switch" id="autoSyncToggle"></div>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-title">自动同步间隔</div>
                                <div class="setting-description">设置自动同步的时间间隔（1-60分钟）</div>
                            </div>
                            <div class="actions">
                                <select id="autoSyncIntervalSelect">
                                    <option value="1">1分钟</option>
                                    <option value="5">5分钟</option>
                                    <option value="10">10分钟</option>
                                    <option value="15">15分钟</option>
                                    <option value="20">20分钟</option>
                                    <option value="30">30分钟</option>
                                    <option value="45">45分钟</option>
                                    <option value="60">60分钟</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 系统操作 -->
            <div class="tab-content" id="operations">
                <div class="setting-section">
                    <h2>系统操作</h2>
                    <div class="setting-group">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-title">开机自启动</div>
                                <div class="setting-description">应用程序在系统启动时自动运行</div>
                            </div>
                            <div class="actions">
                                <div class="toggle-switch" id="startupToggle"></div>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-description">打开自启动文件夹手动管理快捷方式</div>
                            </div>
                            <div class="actions">
                                <button id="openStartupFolderBtn">打开自启动文件夹</button>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-title">重启应用</div>
                                <div class="setting-description">应用设置更改后重启应用</div>
                            </div>
                            <div class="actions">
                                <button class="primary" id="restartAppBtn">立即重启</button>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-title">自动删除过期作业</div>
                                <div class="setting-description">每次启动软件时自动删除过期的作业</div>
                            </div>
                            <div class="actions">
                                <div class="toggle-switch" id="autoDeleteExpiredHomeworkToggle"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- CI联动设置 -->
            <div class="tab-content" id="ci-integration">
                <div class="setting-section">
                    <h2>CI联动设置</h2>
                    <div class="setting-group">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-title">ClassIsland 联动</div>
                                <div class="setting-description">与 ClassIsland 进行联动，实现自动作业提醒等功能</div>
                            </div>
                            <div class="actions">
                                <div class="toggle-switch" id="ciIntegrationToggle"></div>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-title">下课后自动询问布置作业</div>
                                <div class="setting-description">当 ClassIsland 下课后，自动询问是否布置作业</div>
                            </div>
                            <div class="actions">
                                <div class="toggle-switch" id="ciAutoHomeworkToggle"></div>
                            </div>
                        </div>
                        

                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-title">测试CI联动</div>
                                <div class="setting-description">模拟ClassIsland课程结束事件，测试自动作业提醒功能</div>
                            </div>
                            <div class="actions">
                                <button id="testCiIntegrationBtn">测试</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 启动台标签 -->
            <div class="tab-content" id="launchpad">
                <div class="setting-section">
                    <h2>启动台设置</h2>
                    <div class="launchpad-list" id="launchpadList">
                        <!-- 启动项将在这里显示 -->
                    </div>
                    
                    <div class="add-form">
                        <div class="form-row">
                            <input type="text" class="add-input" id="appNameInput" placeholder="名称">
                            <select class="type-selector" id="appTypeInput">
                                <option value="app">应用程序</option>
                                <option value="link">链接</option>
                            </select>
                        </div>
                        <input type="text" class="add-input" id="appPathInput" placeholder="应用程序路径或链接地址">
                        <input type="text" class="add-input" id="appIconInput" placeholder="图标路径（可选）">
                        <button class="primary" id="addAppBtn">添加</button>
                    </div>
                </div>
            </div>
            
            <!-- 模板管理标签 -->
            <div class="tab-content" id="templates">
                <div class="setting-section">
                    <h2>模板管理</h2>
                    <div class="template-list" id="templateList">
                        <!-- 模板列表将在这里显示 -->
                    </div>
                    
                    <div style="display: flex; justify-content: flex-end; margin-top: 20px;">
                        <button class="primary" id="createTemplateBtn">创建模板</button>
                    </div>
                </div>
            </div>
            
            <!-- 关于标签 -->
            <div class="tab-content" id="about">
                <div class="about-section">
                    <div class="header-section">
                        <img src="../assets/logo.jpg" alt="Logo">
                        <div class="app-name">ClassWindow Plus</div>
                        <div class="slogan">快如闪电</div>
                    </div>
                    
                    <div class="info-card">
                        <div class="about-content">
                            <div class="about-text">开发者：R3N</div>
                            <div class="about-text">版本: 1.2.0</div>
                            <div class="about-text" style="color: red; font-weight: bold; margin-top: 12px;">内测版本，如有问题请加QQ群（1077485994）反馈</div>
                        </div>
                    </div>
                    
                    <div class="footer">
                        <div class="adapt-info">基于classwindow改编</div>
                        <div class="original-info">
                            原作者 GitHub：
                            <a href="https://github.com/xinghai-smartedu/classwindow" target="_blank">https://github.com/xinghai-smartedu/classwindow</a>
                        </div>
                        <div class="copyright">© 2026 ClassWindow Plus. 保留所有权利.</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 简单的设置页面脚本
        const { ipcRenderer, shell } = require('electron');
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Settings page loaded');
            
            // 初始化核心功能
            initCore();
            
            // 添加窗口拖动功能
            addWindowDragSupport();
            
            // 延迟加载云端同步设置，确保页面元素完全加载
            setTimeout(function() {
                console.log('延迟加载云端同步设置');
                loadCloudSyncSettings();
                
                // 根据当前主题初始化导航菜单显示
                const themeSelect = document.getElementById('themeSelect');
                if (themeSelect) {
                    const currentTheme = themeSelect.value;
                    console.log('根据当前主题初始化导航菜单:', currentTheme);
                    updateNavigationByTheme(currentTheme);
                }
            }, 100);
        });
        
        // 导航指示器位置更新函数
        function updateNavIndicator() {
            const activeNavItem = document.querySelector('.nav-item.active');
            const navIndicator = document.getElementById('navIndicator');
            if (activeNavItem && navIndicator) {
                const rect = activeNavItem.getBoundingClientRect();
                const sidebarRect = document.querySelector('.sidebar').getBoundingClientRect();
                navIndicator.style.top = `${rect.top - sidebarRect.top}px`;
                navIndicator.style.height = `${rect.height}px`;
            }
        }
        
        // 初始化核心功能
        function initCore() {
            // 初始化标签页切换
            initTabSwitching();
            
            // 初始化侧边栏折叠/展开功能
            initSidebarToggle();
            
            // 初始化事件监听器
            initEventListeners();
            
            // 处理外部链接
            initExternalLinks();
            
            // 初始化启动台管理
            initLaunchpadManagement();
            
            // 初始化模板管理
            initTemplateManagement();
            
            // 页面加载时初始化导航指示器位置
            setTimeout(updateNavIndicator, 100);
            
            // 请求获取当前设置
            ipcRenderer.send('get-settings');
        }
        
        // 初始化侧边栏折叠/展开功能
        function initSidebarToggle() {
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebarToggle');
            
            if (sidebar && sidebarToggle) {
                sidebarToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('collapsed');
                    this.classList.toggle('collapsed');
                    // 延迟更新导航指示器位置，确保DOM已经更新
                    setTimeout(updateNavIndicator, 300);
                });
            }
        }
        
        // 初始化标签页切换
        function initTabSwitching() {
            const navItems = document.querySelectorAll('.nav-item');
            const tabContents = document.querySelectorAll('.tab-content');
            const mainContent = document.querySelector('.main-content');
            
            navItems.forEach(item => {
                item.addEventListener('click', function() {
                    // 移除所有active类
                    navItems.forEach(nav => nav.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    // 添加active类到当前点击的标签
                    const tabId = this.dataset.tab;
                    this.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                    
                    // 更新导航指示器位置
                    updateNavIndicator();
                    
                    // 重置主内容区域的滚动位置到顶部
                    if (mainContent) {
                        mainContent.scrollTop = 0;
                    }
                });
            });
            
            // 侧边栏折叠/展开时更新指示器位置
            window.addEventListener('resize', updateNavIndicator);
        }
        
        // 初始化事件监听器
        function initEventListeners() {
            console.log('Initializing event listeners');
            
            // 关闭按钮
            const titleCloseBtn = document.getElementById('titleCloseBtn');
            if (titleCloseBtn) {
                titleCloseBtn.addEventListener('click', function() {
                    window.close();
                });
            }
            
            // 主题选择
            const themeSelect = document.getElementById('themeSelect');
            if (themeSelect) {
                themeSelect.addEventListener('change', function() {
                    ipcRenderer.send('set-theme', this.value);
                    // 根据当前主题更新导航菜单显示
                    updateNavigationByTheme(this.value);
                });
            }
            
            // 大屏模式列数选择
            const bigScreenColumnsSelect = document.getElementById('bigScreenColumnsSelect');
            if (bigScreenColumnsSelect) {
                bigScreenColumnsSelect.addEventListener('change', function() {
                    ipcRenderer.send('set-big-screen-columns', this.value);
                });
            }
            
            // 窗口位置选择
            const windowPositionSelect = document.getElementById('windowPositionSelect');
            if (windowPositionSelect) {
                windowPositionSelect.addEventListener('change', function() {
                    ipcRenderer.send('set-window-position', this.value);
                });
            }
            
            // 自动同步开关
            const autoSyncToggle = document.getElementById('autoSyncToggle');
            if (autoSyncToggle) {
                autoSyncToggle.addEventListener('click', function() {
                    this.classList.toggle('active');
                    const isEnabled = this.classList.contains('active');
                    localStorage.setItem('autoSyncEnabled', isEnabled.toString());
                    ipcRenderer.send('set-auto-sync-enabled', isEnabled);
                    
                    // 根据自动同步开关状态显示/隐藏自动同步间隔设置
                    const autoSyncIntervalSelect = document.getElementById('autoSyncIntervalSelect');
                    const autoSyncIntervalItem = autoSyncIntervalSelect ? autoSyncIntervalSelect.closest('.setting-item') : null;
                    if (autoSyncIntervalItem) {
                        autoSyncIntervalItem.style.display = isEnabled ? 'flex' : 'none';
                    }
                });
            }
            
            // 自动同步间隔选择
            const autoSyncIntervalSelect = document.getElementById('autoSyncIntervalSelect');
            if (autoSyncIntervalSelect) {
                autoSyncIntervalSelect.addEventListener('change', function() {
                    const interval = parseInt(this.value);
                    localStorage.setItem('autoSyncInterval', this.value);
                    ipcRenderer.send('set-auto-sync-interval', interval);
                });
            }
            
            // 大屏模式字号滑块
            const bigScreenFontSizeSlider = document.getElementById('bigScreenFontSizeSlider');
            if (bigScreenFontSizeSlider) {
                bigScreenFontSizeSlider.addEventListener('input', function() {
                    const value = document.getElementById('bigScreenFontSizeValue');
                    if (value) value.textContent = this.value;
                    ipcRenderer.send('set-big-screen-font-size', parseInt(this.value));
                });
            }
            
            // 大屏模式不透明度滑块
            const bigScreenOpacitySlider = document.getElementById('bigScreenOpacitySlider');
            if (bigScreenOpacitySlider) {
                bigScreenOpacitySlider.addEventListener('input', function() {
                    const value = document.getElementById('bigScreenOpacityValue');
                    if (value) value.textContent = this.value;
                    ipcRenderer.send('set-big-screen-opacity', parseInt(this.value));
                });
            }
            
            // 大屏模式样式选择
            const bigScreenStyleSelect = document.getElementById('bigScreenStyleSelect');
            if (bigScreenStyleSelect) {
                bigScreenStyleSelect.addEventListener('change', function() {
                    ipcRenderer.send('set-big-screen-style', this.value);
                });
            }
            

            
           
            
            // 主界面缩放滑块
            const mainInterfaceScaleSlider = document.getElementById('mainInterfaceScaleSlider');
            if (mainInterfaceScaleSlider) {
                mainInterfaceScaleSlider.addEventListener('input', function() {
                    const value = document.getElementById('mainInterfaceScaleValue');
                    if (value) value.textContent = this.value + '%';
                    ipcRenderer.send('set-main-interface-scale', parseInt(this.value));
                });
            }
            
            // 显示时间开关
            const showClockToggle = document.getElementById('showClockToggle');
            if (showClockToggle) {
                showClockToggle.addEventListener('click', function() {
                    this.classList.toggle('active');
                    const isEnabled = this.classList.contains('active');
                    ipcRenderer.send('toggle-clock', isEnabled);
                });
            }
            
            // 显示作业开关
            const showHomeworkToggle = document.getElementById('showHomeworkToggle');
            if (showHomeworkToggle) {
                showHomeworkToggle.addEventListener('click', function() {
                    this.classList.toggle('active');
                    const isEnabled = this.classList.contains('active');
                    ipcRenderer.send('toggle-homework', isEnabled);
                });
            }
            
            // 显示启动台开关
            const showLaunchpadToggle = document.getElementById('showLaunchpadToggle');
            if (showLaunchpadToggle) {
                showLaunchpadToggle.addEventListener('click', function() {
                    this.classList.toggle('active');
                    const isEnabled = this.classList.contains('active');
                    ipcRenderer.send('toggle-launchpad', isEnabled);
                });
            }
            
            // 启动开关
            const startupToggle = document.getElementById('startupToggle');
            if (startupToggle) {
                startupToggle.addEventListener('click', function() {
                    this.classList.toggle('active');
                    ipcRenderer.send('toggle-startup', this.classList.contains('active'));
                });
            }
            
            // CI联动开关
            const ciIntegrationToggle = document.getElementById('ciIntegrationToggle');
            if (ciIntegrationToggle) {
                ciIntegrationToggle.addEventListener('click', function() {
                    this.classList.toggle('active');
                });
            }
            
            // CI自动作业开关
            const ciAutoHomeworkToggle = document.getElementById('ciAutoHomeworkToggle');
            if (ciAutoHomeworkToggle) {
                ciAutoHomeworkToggle.addEventListener('click', function() {
                    this.classList.toggle('active');
                    ipcRenderer.send('toggle-ci-auto-homework', this.classList.contains('active'));
                });
            }
            
            // 自动删除过期作业开关
            const autoDeleteExpiredHomeworkToggle = document.getElementById('autoDeleteExpiredHomeworkToggle');
            if (autoDeleteExpiredHomeworkToggle) {
                autoDeleteExpiredHomeworkToggle.addEventListener('click', function() {
                    this.classList.toggle('active');
                    ipcRenderer.send('toggle-auto-delete-expired-homework', this.classList.contains('active'));
                });
            }
            
            // 云端同步开关
            const cloudSyncToggle = document.getElementById('cloudSyncToggle');
            if (cloudSyncToggle) {
                cloudSyncToggle.addEventListener('click', function() {
                    this.classList.toggle('active');
                    // 保存云端同步设置
                    saveCloudSyncSettings();
                });
            }
            
            // 服务器地址输入框
            const serverAddressInput = document.getElementById('serverAddressInput');
            if (serverAddressInput) {
                serverAddressInput.addEventListener('change', function() {
                    // 保存云端同步设置
                    saveCloudSyncSettings();
                });
            }
            
            // 服务器预设选择
            const serverPresetSelect = document.getElementById('serverPresetSelect');
            if (serverPresetSelect) {
                serverPresetSelect.addEventListener('change', function() {
                    const selectedPreset = this.value;
                    if (selectedPreset) {
                        document.getElementById('serverAddressInput').value = selectedPreset;
                        // 保存云端同步设置
                        saveCloudSyncSettings();
                    }
                });
            }
            
            // 启动台添加按钮
            const addAppBtn = document.getElementById('addAppBtn');
            if (addAppBtn) {
                addAppBtn.addEventListener('click', function() {
                    const name = document.getElementById('appNameInput').value.trim();
                    const path = document.getElementById('appPathInput').value.trim();
                    const type = document.getElementById('appTypeInput').value;
                    const icon = document.getElementById('appIconInput').value.trim();
                    
                    if (!name || !path) {
                        alert('请输入名称和路径/链接');
                        return;
                    }
                    
                    ipcRenderer.send('add-launchpad-app', {
                        name,
                        path,
                        type,
                        icon: icon || null
                    });
                    
                    // 清空输入框
                    document.getElementById('appNameInput').value = '';
                    document.getElementById('appPathInput').value = '';
                    document.getElementById('appIconInput').value = '';
                });
            }
            
            // 创建模板按钮
            const createTemplateBtn = document.getElementById('createTemplateBtn');
            if (createTemplateBtn) {
                createTemplateBtn.addEventListener('click', function() {
                    ipcRenderer.send('open-template-designer-window');
                });
            }
            
            // 同步到云端按钮
            const syncToCloudBtn = document.getElementById('syncToCloudBtn');
            if (syncToCloudBtn) {
                syncToCloudBtn.addEventListener('click', function() {
                    syncToCloud();
                });
            }
            
            // 从云端同步按钮
            const syncFromCloudBtn = document.getElementById('syncFromCloudBtn');
            if (syncFromCloudBtn) {
                syncFromCloudBtn.addEventListener('click', function() {
                    syncFromCloud();
                });
            }
            
            // 重启应用按钮
            const restartAppBtn = document.getElementById('restartAppBtn');
            if (restartAppBtn) {
                restartAppBtn.addEventListener('click', function() {
                    ipcRenderer.send('restart-app');
                });
            }
            
            // 打开自启动文件夹按钮
            const openStartupFolderBtn = document.getElementById('openStartupFolderBtn');
            if (openStartupFolderBtn) {
                openStartupFolderBtn.addEventListener('click', function() {
                    ipcRenderer.send('open-startup-folder');
                });
            }
            
            // 测试CI联动按钮
            const testCiIntegrationBtn = document.getElementById('testCiIntegrationBtn');
            if (testCiIntegrationBtn) {
                testCiIntegrationBtn.addEventListener('click', function() {
                    ipcRenderer.send('test-ci-integration');
                });
            }
            
            // 打开账号管理按钮
            const openAccountManagementBtn = document.getElementById('openAccountManagementBtn');
            if (openAccountManagementBtn) {
                openAccountManagementBtn.addEventListener('click', function() {
                    openAccountManagement();
                });
            }
        }
        
        // 初始化外部链接处理
        function initExternalLinks() {
            document.addEventListener('click', function(event) {
                const anchor = event.target.closest('a');
                if (anchor && anchor.href) {
                    event.preventDefault();
                    shell.openExternal(anchor.href);
                }
            });
        }
        
        // 添加窗口拖动功能
        function addWindowDragSupport() {
            const titleBar = document.querySelector('.title-bar');
            if (!titleBar) return;
            
            let isDragging = false;
            let startX, startY;
            
            // 鼠标事件
            titleBar.addEventListener('mousedown', function(e) {
                if (!e.target.closest('.title-bar-button')) {
                    isDragging = true;
                    startX = e.clientX;
                    startY = e.clientY;
                }
            });
            
            document.addEventListener('mousemove', function(e) {
                if (isDragging) {
                    const deltaX = e.clientX - startX;
                    const deltaY = e.clientY - startY;
                    startX = e.clientX;
                    startY = e.clientY;
                    
                    ipcRenderer.send('move-window', deltaX, deltaY);
                }
            });
            
            document.addEventListener('mouseup', function() {
                if (isDragging) {
                    isDragging = false;
                }
            });
        }
        
        // 初始化启动台管理
        function initLaunchpadManagement() {
            console.log('Initializing launchpad management');
            // 这里可以添加启动台列表的初始化逻辑
        }
        
        // 初始化模板管理
        function initTemplateManagement() {
            console.log('Initializing template management');
            // 加载并显示模板列表
            loadTemplateList();
            
            // 监听模板更新事件
            ipcRenderer.on('template-updated', () => {
                console.log('Template updated event received, refreshing template list');
                loadTemplateList();
            });
        }
        
        // 加载模板列表
        function loadTemplateList() {
            try {
                // 直接从localStorage读取模板数据
                const TEMPLATE_STORAGE_KEY = 'homeworkTemplates';
                const templates = JSON.parse(localStorage.getItem(TEMPLATE_STORAGE_KEY) || '[]');
                
                console.log('模板数据:', templates);
                
                const templateList = document.getElementById('templateList');
                if (!templateList) return;
                
                if (templates.length === 0) {
                    templateList.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">暂无模板</p>';
                    return;
                }
                
                templateList.innerHTML = '';
                
                templates.forEach((template, index) => {
                    console.log('模板', index, ':', template);
                    
                    const templateItem = document.createElement('div');
                    // 重写样式，使用更简单直接的布局
                    templateItem.style.cssText = `
                        width: 100%;
                        min-width: 0;
                        box-sizing: border-box;
                        background-color: white;
                        border-radius: 8px;
                        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                        margin: 0 0 16px 0;
                        padding: 20px;
                        display: block;
                    `;
                    
                    // 生成组件信息
                    let componentsInfo = '';
                    if (template.components && template.components.length > 0) {
                        componentsInfo = `<div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #f0f0f0; width: 100%; min-width: 0;">
                            <div style="font-size: 14px; font-weight: 500; color: #333; margin-bottom: 8px;">组件 (${template.components.length}个):</div>
                            <div style="display: flex; flex-wrap: wrap; gap: 8px; width: 100%; min-width: 0;">
                                ${template.components.map(comp => {
                                    let compType = '未知组件';
                                    let compColor = '#999';
                                    switch (comp.type) {
                                        case 'fixedText':
                                            compType = '固定文本';
                                            compColor = '#0078d4';
                                            break;
                                        case 'numberSelect':
                                            compType = '数字选择';
                                            compColor = '#4CAF50';
                                            break;
                                        case 'textDropdown':
                                            compType = '文本下拉';
                                            compColor = '#FF9800';
                                            break;
                                    }
                                    return `<span style="padding: 4px 12px; border-radius: 16px; font-size: 12px; background-color: ${compColor}20; color: ${compColor}; border: 1px solid ${compColor}40;">${compType}</span>`;
                                }).join('')}
                            </div>
                        </div>`;
                    } else {
                        componentsInfo = `<div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #f0f0f0; font-size: 14px; color: #999; width: 100%; min-width: 0;">无组件</div>`;
                    }
                    
                    // 重写HTML结构，使用更简单的布局
                    templateItem.innerHTML = `
                        <div style="width: 100%; min-width: 0; box-sizing: border-box;">
                            <div style="width: 100%; min-width: 0; margin-bottom: 8px;">
                                <div style="font-size: 18px; font-weight: 600; color: #333; min-width: 0; margin-bottom: 8px;">${template.name}</div>
                                <div style="font-size: 14px; color: #666; line-height: 1.4; min-width: 0; margin-bottom: 8px;">${template.description || '无描述'}</div>
                                <div style="font-size: 12px; color: #ccc; width: 100%; text-align: right; min-width: 0; margin-bottom: 12px;">
                                    创建时间: ${new Date(template.createdAt || Date.now()).toLocaleString()}
                                </div>
                            </div>
                            ${componentsInfo}
                            <div style="width: 100%; min-width: 0; text-align: right; margin-top: 12px;">
                                <button onclick="editTemplate('${template.id}')" style="padding: 6px 12px; background-color: #0078d4; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; margin-right: 8px;">编辑</button>
                                <button onclick="deleteTemplate('${template.id}')" style="padding: 6px 12px; background-color: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;">删除</button>
                            </div>
                        </div>
                    `;
                    
                    templateList.appendChild(templateItem);
                });
            } catch (error) {
                console.error('加载模板列表失败:', error);
                const templateList = document.getElementById('templateList');
                if (templateList) {
                    templateList.innerHTML = '<p style="text-align: center; color: #f44336; padding: 20px;">加载模板失败</p>';
                }
            }
        }
        
        // 编辑模板
        window.editTemplate = function(id) {
            // 通知主进程打开模板设计器并编辑指定模板
            ipcRenderer.send('open-template-designer-window', id);
        }
        
        // 删除模板
        window.deleteTemplate = function(id) {
            if (confirm('确定要删除这个模板吗？')) {
                try {
                    // 直接操作localStorage删除模板
                    const TEMPLATE_STORAGE_KEY = 'homeworkTemplates';
                    const templates = JSON.parse(localStorage.getItem(TEMPLATE_STORAGE_KEY) || '[]');
                    const filteredTemplates = templates.filter(template => template.id !== id);
                    localStorage.setItem(TEMPLATE_STORAGE_KEY, JSON.stringify(filteredTemplates));
                    
                    // 重新加载模板列表
                    loadTemplateList();
                    // 通知其他窗口模板已更新
                    ipcRenderer.send('template-updated');
                } catch (error) {
                    console.error('删除模板失败:', error);
                    alert('删除模板失败');
                }
            }
        }
        
        // 云端同步相关函数
        async function syncToCloud() {
            console.log('开始执行同步到云端操作...');
            
            try {
                // 获取云端同步设置
                const cloudSyncEnabled = document.getElementById('cloudSyncToggle').classList.contains('active');
                const serverAddress = document.getElementById('serverAddressInput').value.trim();
                
                // 验证设置
                if (!cloudSyncEnabled) {
                    alert('请先启用云端同步功能');
                    return;
                }
                
                if (!serverAddress) {
                    alert('请输入服务器地址');
                    return;
                }
                
                // 从localStorage获取账号信息
                let schoolCode = '';
                let classCode = '';
                let teacherPassword = '';
                
                try {
                    const accountInfo = localStorage.getItem('cloudSyncAccount');
                    if (accountInfo) {
                        const accountData = JSON.parse(accountInfo);
                        schoolCode = accountData.schoolCode || '';
                        classCode = accountData.classCode || '';
                        teacherPassword = accountData.password || '';
                    }
                } catch (e) {
                    console.error('获取账号信息失败:', e);
                }
                
                if (!schoolCode || !classCode || !teacherPassword) {
                    alert('请先在账号管理中设置学校代码、班级代码和教师密码');
                    return;
                }
                
                // 显示加载状态
                showSyncStatus('正在同步到云端...');
                
                // 获取作业数据
                const homeworkData = await new Promise((resolve) => {
                    ipcRenderer.send('get-homework-data');
                    ipcRenderer.once('homework-data', (event, data) => {
                        resolve(data || []);
                    });
                });
                
                console.log('获取到作业数据:', homeworkData.length);
                
                // 构建同步数据
                const syncData = {
                    action: 'upload',
                    schoolCode: schoolCode,
                    classCode: classCode,
                    password: teacherPassword,
                    homeworkData: homeworkData
                };
                
                // 验证并修正URL格式
                let correctedServerAddress = serverAddress;
                if (!correctedServerAddress.startsWith('http://') && !correctedServerAddress.startsWith('https://')) {
                    correctedServerAddress = 'http://' + correctedServerAddress;
                }
                
                // 确保URL指向正确的API文件
                if (!correctedServerAddress.endsWith('/homework-sync.php') && !correctedServerAddress.endsWith('/homework-sync.php/')) {
                    if (correctedServerAddress.endsWith('/')) {
                        correctedServerAddress += 'homework-sync.php';
                    } else {
                        correctedServerAddress += '/homework-sync.php';
                    }
                }
                
                console.log('同步到云端，服务器地址:', correctedServerAddress);
                
                // 发送请求到服务器
                const response = await fetch(correctedServerAddress, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest',
                        'Referer': correctedServerAddress,
                        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'
                    },
                    body: JSON.stringify(syncData)
                });
                
                if (!response.ok) {
                    throw new Error(`服务器响应错误: ${response.status} ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('同步响应数据:', data);
                
                if (data.success) {
                    showSyncStatus('作业已成功同步到云端', 'success');
                    alert(`作业已成功同步到云端\n共 ${data.homeworkCount || homeworkData.length} 个作业`);
                } else {
                    showSyncStatus('同步失败', 'error');
                    alert(`同步失败: ${data.message || '未知错误'}`);
                }
                
            } catch (error) {
                console.error('同步到云端失败:', error);
                showSyncStatus('同步失败', 'error');
                alert(`同步到云端失败: ${error.message || '未知错误'}`);
            }
        }
        
        async function syncFromCloud() {
            try {
                const cloudSyncEnabled = document.getElementById('cloudSyncToggle').classList.contains('active');
                if (!cloudSyncEnabled) {
                    alert('请先启用云端同步功能');
                    return;
                }
                
                const serverAddress = document.getElementById('serverAddressInput').value.trim();
                if (!serverAddress) {
                    alert('请输入服务器地址');
                    return;
                }
                
                // 从localStorage获取账号信息
                let schoolCode = '';
                let classCode = '';
                let teacherPassword = '';
                
                try {
                    const accountInfo = localStorage.getItem('cloudSyncAccount');
                    if (accountInfo) {
                        const accountData = JSON.parse(accountInfo);
                        schoolCode = accountData.schoolCode || '';
                        classCode = accountData.classCode || '';
                        teacherPassword = accountData.password || '';
                    }
                } catch (e) {
                    console.error('获取账号信息失败:', e);
                }
                
                if (!schoolCode || !classCode || !teacherPassword) {
                    alert('请先在账号管理中设置学校代码、班级代码和教师密码');
                    return;
                }
                
                // 显示加载状态
                showSyncStatus('正在从云端同步...');
                
                // 验证并修正URL格式
                let correctedServerAddress = serverAddress;
                if (!correctedServerAddress.startsWith('http://') && !correctedServerAddress.startsWith('https://')) {
                    correctedServerAddress = 'http://' + correctedServerAddress;
                }
                
                // 确保URL指向正确的API文件
                if (!correctedServerAddress.endsWith('/homework-sync.php') && !correctedServerAddress.endsWith('/homework-sync.php/')) {
                    if (correctedServerAddress.endsWith('/')) {
                        correctedServerAddress += 'homework-sync.php';
                    } else {
                        correctedServerAddress += '/homework-sync.php';
                    }
                }
                
                console.log('从云端同步，服务器地址:', correctedServerAddress);
                
                // 构建同步数据
                const syncData = {
                    action: 'download',
                    schoolCode: schoolCode,
                    classCode: classCode,
                    password: teacherPassword
                };
                
                // 发送请求到服务器
                const response = await fetch(correctedServerAddress, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest',
                        'Referer': correctedServerAddress,
                        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'
                    },
                    body: JSON.stringify(syncData)
                });
                
                if (!response.ok) {
                    throw new Error(`服务器响应错误: ${response.status} ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('同步响应数据:', data);
                
                if (data.success && data.homeworkData) {
                    // 保存作业数据到本地
                    ipcRenderer.send('set-homework-data', data.homeworkData);
                    showSyncStatus('已成功从云端同步', 'success');
                    alert(`已成功从云端同步\n共 ${data.homeworkCount || data.homeworkData.length} 个作业`);
                } else {
                    showSyncStatus('同步失败', 'error');
                    alert(`同步失败: ${data.message || '未知错误'}`);
                }
                
            } catch (error) {
                console.error('从云端同步失败:', error);
                showSyncStatus('同步失败', 'error');
                alert(`从云端同步失败: ${error.message || '未知错误'}`);
            }
        }
        
        // 显示同步状态
        function showSyncStatus(message, type = 'info') {
            // 创建状态显示元素
            let statusElement = document.getElementById('syncStatus');
            if (!statusElement) {
                statusElement = document.createElement('div');
                statusElement.id = 'syncStatus';
                statusElement.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 12px 16px;
                    border-radius: 8px;
                    color: white;
                    font-size: 14px;
                    font-weight: 500;
                    z-index: 10000;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                    transition: all 0.3s ease;
                    max-width: 300px;
                    word-wrap: break-word;
                `;
                document.body.appendChild(statusElement);
            }
            
            // 设置状态样式
            switch (type) {
                case 'success':
                    statusElement.style.backgroundColor = '#4CAF50';
                    break;
                case 'error':
                    statusElement.style.backgroundColor = '#f44336';
                    break;
                default:
                    statusElement.style.backgroundColor = '#0078d4';
            }
            
            // 设置状态消息
            statusElement.textContent = message;
            statusElement.style.opacity = '1';
            statusElement.style.transform = 'translateX(0)';
            
            // 3秒后隐藏
            setTimeout(() => {
                statusElement.style.opacity = '0';
                statusElement.style.transform = 'translateX(100%)';
            }, 3000);
        }
        
        // 监听设置状态更新
        ipcRenderer.on('settings-updated', function(event, settings) {
            console.log('Settings updated:', settings);
            
            // 更新启动开关状态
            const startupToggle = document.getElementById('startupToggle');
            if (startupToggle) {
                startupToggle.classList.toggle('active', settings.startupEnabled);
            }
            
            // 更新CI自动作业开关状态
            const ciAutoHomeworkToggle = document.getElementById('ciAutoHomeworkToggle');
            if (ciAutoHomeworkToggle) {
                ciAutoHomeworkToggle.classList.toggle('active', settings.ciAutoHomeworkEnabled);
            }
            
            // 更新云端同步设置
            const cloudSyncToggle = document.getElementById('cloudSyncToggle');
            if (cloudSyncToggle) {
                cloudSyncToggle.classList.toggle('active', settings.cloudSyncEnabled || false);
            }
            
            const serverAddressInput = document.getElementById('serverAddressInput');
            if (serverAddressInput) {
                serverAddressInput.value = settings.serverAddress || '';
            }
            
            // 更新滑块状态
            const sliders = [
                { id: 'bigScreenFontSizeSlider', value: settings.bigScreenFontSize || 14, display: 'bigScreenFontSizeValue' },
                { id: 'bigScreenOpacitySlider', value: settings.bigScreenOpacity || 95, display: 'bigScreenOpacityValue' },
                { id: 'mainInterfaceScaleSlider', value: settings.mainInterfaceScale || 100, display: 'mainInterfaceScaleValue', suffix: '%' }
            ];
            
            // 更新大屏模式样式选择
            const bigScreenStyleSelect = document.getElementById('bigScreenStyleSelect');
            if (bigScreenStyleSelect) {
                bigScreenStyleSelect.value = settings.bigScreenStyle || 'classwindow-plus';
            }
            
            sliders.forEach(slider => {
                const element = document.getElementById(slider.id);
                const display = document.getElementById(slider.display);
                if (element) {
                    element.value = slider.value;
                    if (display) {
                        display.textContent = slider.value + (slider.suffix || '');
                    }
                }
            });
            
            // 更新选择框状态
            const selects = [
                { id: 'themeSelect', value: settings.theme || 'personal' },
                { id: 'bigScreenColumnsSelect', value: settings.bigScreenColumns || '2' }
            ];
            
            selects.forEach(select => {
                const element = document.getElementById(select.id);
                if (element) {
                    element.value = select.value;
                }
            });
            
            // 更新显示时间开关状态
            const showClockToggle = document.getElementById('showClockToggle');
            if (showClockToggle) {
                showClockToggle.classList.toggle('active', settings.clockEnabled !== false);
            }
            
            // 更新显示作业开关状态
            const showHomeworkToggle = document.getElementById('showHomeworkToggle');
            if (showHomeworkToggle) {
                showHomeworkToggle.classList.toggle('active', settings.homeworkEnabled !== false);
            }
            
            // 更新显示启动台开关状态
            const showLaunchpadToggle = document.getElementById('showLaunchpadToggle');
            if (showLaunchpadToggle) {
                showLaunchpadToggle.classList.toggle('active', settings.launchpadEnabled !== false);
            }
        });
        
        // 监听启动台应用更新
        ipcRenderer.on('launchpad-apps-updated', function(event, apps) {
            console.log('Launchpad apps updated:', apps);
            updateLaunchpadList(apps);
        });
        
        // 更新启动台列表
        function updateLaunchpadList(apps) {
            const launchpadList = document.getElementById('launchpadList');
            if (!launchpadList) return;
            
            if (apps.length === 0) {
                launchpadList.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">暂无启动项</p>';
                return;
            }
            
            launchpadList.innerHTML = '';
            
            apps.forEach((app, index) => {
                const appItem = document.createElement('div');
                appItem.className = 'launchpad-item';
                
                appItem.innerHTML = `
                    <div class="app-info">
                        <div class="app-name">${app.name}</div>
                        <div class="app-path">${app.path}</div>
                    </div>
                    <div class="actions">
                        <button onclick="removeLaunchpadApp(${index})">删除</button>
                    </div>
                `;
                
                launchpadList.appendChild(appItem);
            });
        }
        
        // 移除启动台应用
        window.removeLaunchpadApp = function(index) {
            console.log('Remove app at index:', index);
            ipcRenderer.send('remove-launchpad-app', index);
        }
        
        // 打开账号管理窗口
        function openAccountManagement() {
            // 创建账号管理弹窗
            const dialog = document.createElement('div');
            dialog.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                pointer-events: auto;
            `;
            
            // 从localStorage获取现有账号信息
            let existingSchoolCode = '';
            let existingClassCode = '';
            let existingPassword = '';
            
            try {
                const accountInfo = localStorage.getItem('cloudSyncAccount');
                if (accountInfo) {
                    const accountData = JSON.parse(accountInfo);
                    existingSchoolCode = accountData.schoolCode || '';
                    existingClassCode = accountData.classCode || '';
                    existingPassword = accountData.password || '';
                }
            } catch (e) {
                console.error('获取账号信息失败:', e);
            }
            
            // 弹窗内容
            dialog.innerHTML = `
                <div style="
                    background-color: white;
                    border-radius: 8px;
                    padding: 24px;
                    width: 400px;
                    max-width: 90%;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                    z-index: 10001;
                    pointer-events: auto;
                ">
                    <h2 style="margin-top: 0; margin-bottom: 20px; color: #333;">账号管理</h2>
                    <div style="display: flex; flex-direction: column; gap: 16px;">
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 500;">学校代码</label>
                            <input type="text" id="schoolCodeInput" value="${existingSchoolCode}" style="
                                width: 100%;
                                padding: 8px 12px;
                                border: 1px solid #e0e0e0;
                                border-radius: 4px;
                                font-size: 14px;
                                pointer-events: auto;
                                z-index: 10002;
                                position: relative;
                                background-color: white;
                            ">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 500;">班级代码</label>
                            <input type="text" id="classCodeInput" value="${existingClassCode}" style="
                                width: 100%;
                                padding: 8px 12px;
                                border: 1px solid #e0e0e0;
                                border-radius: 4px;
                                font-size: 14px;
                                pointer-events: auto;
                                z-index: 10002;
                                position: relative;
                                background-color: white;
                            ">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 500;">教师密码</label>
                            <input type="password" id="teacherPasswordInput" value="${existingPassword}" style="
                                width: 100%;
                                padding: 8px 12px;
                                border: 1px solid #e0e0e0;
                                border-radius: 4px;
                                font-size: 14px;
                                pointer-events: auto;
                                z-index: 10002;
                                position: relative;
                                background-color: white;
                            ">
                        </div>
                        <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 8px;">
                            <button id="cancelAccountBtn" style="
                                padding: 8px 16px;
                                border: 1px solid #e0e0e0;
                                border-radius: 4px;
                                background-color: white;
                                cursor: pointer;
                            ">取消</button>
                            <button id="registerAccountBtn" style="
                                padding: 8px 16px;
                                border: 1px solid #4CAF50;
                                border-radius: 4px;
                                background-color: #4CAF50;
                                color: white;
                                cursor: pointer;
                            ">注册</button>
                            <button id="saveAccountBtn" style="
                                padding: 8px 16px;
                                border: 1px solid #0078d4;
                                border-radius: 4px;
                                background-color: #0078d4;
                                color: white;
                                cursor: pointer;
                            ">保存并登录</button>
                        </div>
                    </div>
                </div>
            `;
            
            // 添加到文档
            document.body.appendChild(dialog);
            
            // 取消按钮
            const cancelBtn = dialog.querySelector('#cancelAccountBtn');
            cancelBtn.addEventListener('click', function() {
                document.body.removeChild(dialog);
            });
            
            // 注册按钮
            const registerBtn = dialog.querySelector('#registerAccountBtn');
            registerBtn.addEventListener('click', function() {
                const schoolCode = dialog.querySelector('#schoolCodeInput').value.trim();
                const classCode = dialog.querySelector('#classCodeInput').value.trim();
                const password = dialog.querySelector('#teacherPasswordInput').value.trim();
                
                if (!schoolCode || !classCode || !password) {
                    alert('请填写完整的账号信息');
                    return;
                }
                
                // 注册新账号
                registerAccount(schoolCode, classCode, password, dialog);
            });
            
            // 保存并登录按钮
            const saveBtn = dialog.querySelector('#saveAccountBtn');
            saveBtn.addEventListener('click', function() {
                const schoolCode = dialog.querySelector('#schoolCodeInput').value.trim();
                const classCode = dialog.querySelector('#classCodeInput').value.trim();
                const password = dialog.querySelector('#teacherPasswordInput').value.trim();
                
                if (!schoolCode || !classCode || !password) {
                    alert('请填写完整的账号信息');
                    return;
                }
                
                // 先尝试登录验证
                loginAccount(schoolCode, classCode, password, dialog);
            });
            
            // 点击外部关闭
            dialog.addEventListener('click', function(e) {
                if (e.target === dialog) {
                    document.body.removeChild(dialog);
                }
            });
        }
        
        // 注册账号
        async function registerAccount(schoolCode, classCode, password, dialog) {
            try {
                const serverAddress = document.getElementById('serverAddressInput').value.trim() || 'http://1.12.218.107:345/homework-sync.php';
                
                // 构建注册数据
                const registerData = {
                    action: 'register',
                    schoolCode: schoolCode,
                    classCode: classCode,
                    password: password
                };
                
                // 显示加载状态
                const originalText = dialog.querySelector('#registerAccountBtn').textContent;
                dialog.querySelector('#registerAccountBtn').textContent = '注册中...';
                dialog.querySelector('#registerAccountBtn').disabled = true;
                
                // 发送注册请求
                const response = await fetch(serverAddress, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest',
                        'Referer': serverAddress,
                        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'
                    },
                    body: JSON.stringify(registerData)
                });
                
                const data = await response.json();
                console.log('注册响应:', data);
                
                // 恢复按钮状态
                dialog.querySelector('#registerAccountBtn').textContent = originalText;
                dialog.querySelector('#registerAccountBtn').disabled = false;
                
                if (data.success) {
                    // 注册成功，保存账号信息
                    const accountData = {
                        schoolCode: schoolCode,
                        classCode: classCode,
                        password: password
                    };
                    
                    try {
                        localStorage.setItem('cloudSyncAccount', JSON.stringify(accountData));
                        alert('注册成功！账号信息已保存');
                        document.body.removeChild(dialog);
                    } catch (e) {
                        console.error('保存账号信息失败:', e);
                        alert('注册成功，但保存账号信息失败: ' + e.message);
                    }
                } else {
                    alert('注册失败: ' + (data.message || '未知错误'));
                }
                
            } catch (error) {
                console.error('注册失败:', error);
                dialog.querySelector('#registerAccountBtn').textContent = '注册';
                dialog.querySelector('#registerAccountBtn').disabled = false;
                alert('注册失败: ' + error.message);
            }
        }
        
        // 登录账号
        async function loginAccount(schoolCode, classCode, password, dialog) {
            try {
                const serverAddress = document.getElementById('serverAddressInput').value.trim() || 'http://1.12.218.107:345/homework-sync.php';
                
                // 构建登录数据
                const loginData = {
                    action: 'teacherLogin',
                    schoolCode: schoolCode,
                    classCode: classCode,
                    password: password
                };
                
                // 显示加载状态
                const originalText = dialog.querySelector('#saveAccountBtn').textContent;
                dialog.querySelector('#saveAccountBtn').textContent = '登录中...';
                dialog.querySelector('#saveAccountBtn').disabled = true;
                
                // 发送登录请求
                const response = await fetch(serverAddress, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest',
                        'Referer': serverAddress,
                        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'
                    },
                    body: JSON.stringify(loginData)
                });
                
                const data = await response.json();
                console.log('登录响应:', data);
                
                // 恢复按钮状态
                dialog.querySelector('#saveAccountBtn').textContent = originalText;
                dialog.querySelector('#saveAccountBtn').disabled = false;
                
                if (data.success) {
                    // 登录成功，保存账号信息
                    const accountData = {
                        schoolCode: schoolCode,
                        classCode: classCode,
                        password: password
                    };
                    
                    try {
                        localStorage.setItem('cloudSyncAccount', JSON.stringify(accountData));
                        alert('登录成功！账号信息已保存');
                        document.body.removeChild(dialog);
                    } catch (e) {
                        console.error('保存账号信息失败:', e);
                        alert('登录成功，但保存账号信息失败: ' + e.message);
                    }
                } else {
                    alert('登录失败: ' + (data.message || '未知错误') + '\n\n如果账号不存在，请点击"注册"按钮创建新账号');
                }
                
            } catch (error) {
                console.error('登录失败:', error);
                dialog.querySelector('#saveAccountBtn').textContent = '保存并登录';
                dialog.querySelector('#saveAccountBtn').disabled = false;
                alert('登录失败: ' + error.message);
            }
        }
        
        // 保存云端同步设置
        function saveCloudSyncSettings() {
            try {
                const cloudSyncEnabled = document.getElementById('cloudSyncToggle').classList.contains('active');
                const serverAddress = document.getElementById('serverAddressInput').value.trim();
                
                const cloudSyncSettings = {
                    enabled: cloudSyncEnabled,
                    serverAddress: serverAddress
                };
                
                localStorage.setItem('cloudSyncSettings', JSON.stringify(cloudSyncSettings));
                console.log('云端同步设置已保存:', cloudSyncSettings);
            } catch (error) {
                console.error('保存云端同步设置失败:', error);
            }
        }
        
        // 加载云端同步设置
        function loadCloudSyncSettings() {
            try {
                const cloudSyncSettings = localStorage.getItem('cloudSyncSettings');
                if (cloudSyncSettings) {
                    const settings = JSON.parse(cloudSyncSettings);
                    
                    const cloudSyncToggle = document.getElementById('cloudSyncToggle');
                    if (cloudSyncToggle) {
                        cloudSyncToggle.classList.toggle('active', settings.enabled || false);
                    }
                    
                    const serverAddressInput = document.getElementById('serverAddressInput');
                    if (serverAddressInput) {
                        serverAddressInput.value = settings.serverAddress || '';
                    }
                    
                    console.log('云端同步设置已加载:', settings);
                }
                
                // 加载自动同步设置
                const autoSyncToggle = document.getElementById('autoSyncToggle');
                const autoSyncIntervalSelect = document.getElementById('autoSyncIntervalSelect');
                // 获取自动同步间隔设置项的父容器
                const autoSyncIntervalItem = autoSyncIntervalSelect ? autoSyncIntervalSelect.closest('.setting-item') : null;
                
                if (autoSyncToggle && autoSyncIntervalItem) {
                    const autoSyncEnabled = localStorage.getItem('autoSyncEnabled') === 'true';
                    autoSyncToggle.classList.toggle('active', autoSyncEnabled);
                    
                    // 根据自动同步开关状态显示/隐藏自动同步间隔设置
                    autoSyncIntervalItem.style.display = autoSyncEnabled ? 'flex' : 'none';
                }
                
                if (autoSyncIntervalSelect) {
                    const autoSyncInterval = localStorage.getItem('autoSyncInterval') || '5';
                    autoSyncIntervalSelect.value = autoSyncInterval;
                }
                
                console.log('自动同步设置已加载');
                console.log('自动同步间隔设置项:', autoSyncIntervalItem);
            } catch (error) {
                console.error('加载云端同步设置失败:', error);
            }
        }
        
        // 根据主题更新导航菜单显示
        function updateNavigationByTheme(theme) {
            console.log('根据主题更新导航菜单:', theme);
            
            // 获取导航菜单中的窗口设置和大屏模式设置项
            const navItems = document.querySelectorAll('.nav-item');
            
            navItems.forEach(item => {
                const tabId = item.dataset.tab;
                
                // 窗口设置只在个人模式时显示
                if (tabId === 'window') {
                    if (theme === 'personal') {
                        item.style.display = 'block';
                    } else {
                        item.style.display = 'none';
                    }
                }
                
                // 大屏模式设置只在大屏模式时显示
                if (tabId === 'big-screen') {
                    if (theme === 'big-screen') {
                        item.style.display = 'block';
                    } else {
                        item.style.display = 'none';
                    }
                }
            });
        }
    </script>
</body>
</html>